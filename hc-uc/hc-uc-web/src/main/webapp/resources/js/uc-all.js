Ext.define("Hc_Framework.Application",{extend:"Ext.app.Application",name:"Hc_Framework",appFolder:"resources/app",controllers:["Root"],launch:function(){console.info("军情解码李金喜")}});
Ext.define("Hc_Framework.controller.Root",{extend:"Ext.app.Controller",onLaunch:function(){var b=this;var a=Ext.create("Hc_Framework.store.CurrentUser");console.info("这是我们的ROOT1:"+a.data.length);a.load();console.info("这是我们的ROOT2:"+a.data.length);if(a.data.length<1){Ext.Ajax.request({url:Hc.basePath+"/getCurrentLoginUser.json",success:function(c){console.info("Root执行了没有");console.info(c.responseText);var e=JSON.parse(c.responseText);if(e.result.resultCode==0){var d=Ext.create(a.model,{userId:e.entity.userId,userCode:e.entity.userCode,userName:e.entity.userName,deptName:e.entity.deptName,isAdminGroup:e.entity.isAdminGroup,email:e.entity.email,password:e.entity.password});d.save();a.add(d);a.sync(true);a.load();console.info("这是我们的ROOT1Main1sssaaaaadasdfasd23232:");console.info("这是我们的ROOT1Main1:"+a.getAt(0).get("userCode"));console.info("这是我们的ROOT1Main2:"+a.getAt(0).get("userName"));console.info("这是我们的ROOT1Main3:"+a.getAt(0).get("email"));console.info("这是我们的ROOT1Main3:"+a.getAt(0).get("deptName"));console.info("这是我们的ROOT1Main4:"+a.getAt(0).get("password"));b.showMainUI(a.getAt(0))}else{Hc.alert(e.result.msg)}},failure:function(){Hc.alert("系统出错")}})}else{b.showMainUI(a.getAt(0))}},showMainUI:function(a){console.info("这是我们的ROOT1Main:"+a);console.info(a);Ext.widget("app-main",{viewModel:{data:{currentUser:a}}})}});

var hexcase=0;var b64pad="";var chrsz=8;function hex_md5(a){return binl2hex(core_md5(str2binl(a),a.length*chrsz))}function b64_md5(a){return binl2b64(core_md5(str2binl(a),a.length*chrsz))}function hex_hmac_md5(a,b){return binl2hex(core_hmac_md5(a,b))}function b64_hmac_md5(a,b){return binl2b64(core_hmac_md5(a,b))}function calcMD5(a){return binl2hex(core_md5(str2binl(a),a.length*chrsz))}function md5_vm_test(){return hex_md5("abc")=="900150983cd24fb0d6963f7d28e17f72"}function core_md5(p,k){p[k>>5]|=128<<((k)%32);p[(((k+64)>>>9)<<4)+14]=k;var o=1732584193;var n=-271733879;var m=-1732584194;var l=271733878;for(var g=0;g<p.length;g+=16){var j=o;var h=n;var f=m;var e=l;o=md5_ff(o,n,m,l,p[g+0],7,-680876936);l=md5_ff(l,o,n,m,p[g+1],12,-389564586);m=md5_ff(m,l,o,n,p[g+2],17,606105819);n=md5_ff(n,m,l,o,p[g+3],22,-1044525330);o=md5_ff(o,n,m,l,p[g+4],7,-176418897);l=md5_ff(l,o,n,m,p[g+5],12,1200080426);m=md5_ff(m,l,o,n,p[g+6],17,-1473231341);n=md5_ff(n,m,l,o,p[g+7],22,-45705983);o=md5_ff(o,n,m,l,p[g+8],7,1770035416);l=md5_ff(l,o,n,m,p[g+9],12,-1958414417);m=md5_ff(m,l,o,n,p[g+10],17,-42063);n=md5_ff(n,m,l,o,p[g+11],22,-1990404162);o=md5_ff(o,n,m,l,p[g+12],7,1804603682);l=md5_ff(l,o,n,m,p[g+13],12,-40341101);m=md5_ff(m,l,o,n,p[g+14],17,-1502002290);n=md5_ff(n,m,l,o,p[g+15],22,1236535329);o=md5_gg(o,n,m,l,p[g+1],5,-165796510);l=md5_gg(l,o,n,m,p[g+6],9,-1069501632);m=md5_gg(m,l,o,n,p[g+11],14,643717713);n=md5_gg(n,m,l,o,p[g+0],20,-373897302);o=md5_gg(o,n,m,l,p[g+5],5,-701558691);l=md5_gg(l,o,n,m,p[g+10],9,38016083);m=md5_gg(m,l,o,n,p[g+15],14,-660478335);n=md5_gg(n,m,l,o,p[g+4],20,-405537848);o=md5_gg(o,n,m,l,p[g+9],5,568446438);l=md5_gg(l,o,n,m,p[g+14],9,-1019803690);m=md5_gg(m,l,o,n,p[g+3],14,-187363961);n=md5_gg(n,m,l,o,p[g+8],20,1163531501);o=md5_gg(o,n,m,l,p[g+13],5,-1444681467);l=md5_gg(l,o,n,m,p[g+2],9,-51403784);m=md5_gg(m,l,o,n,p[g+7],14,1735328473);n=md5_gg(n,m,l,o,p[g+12],20,-1926607734);o=md5_hh(o,n,m,l,p[g+5],4,-378558);l=md5_hh(l,o,n,m,p[g+8],11,-2022574463);m=md5_hh(m,l,o,n,p[g+11],16,1839030562);n=md5_hh(n,m,l,o,p[g+14],23,-35309556);o=md5_hh(o,n,m,l,p[g+1],4,-1530992060);l=md5_hh(l,o,n,m,p[g+4],11,1272893353);m=md5_hh(m,l,o,n,p[g+7],16,-155497632);n=md5_hh(n,m,l,o,p[g+10],23,-1094730640);o=md5_hh(o,n,m,l,p[g+13],4,681279174);l=md5_hh(l,o,n,m,p[g+0],11,-358537222);m=md5_hh(m,l,o,n,p[g+3],16,-722521979);n=md5_hh(n,m,l,o,p[g+6],23,76029189);o=md5_hh(o,n,m,l,p[g+9],4,-640364487);l=md5_hh(l,o,n,m,p[g+12],11,-421815835);m=md5_hh(m,l,o,n,p[g+15],16,530742520);n=md5_hh(n,m,l,o,p[g+2],23,-995338651);o=md5_ii(o,n,m,l,p[g+0],6,-198630844);l=md5_ii(l,o,n,m,p[g+7],10,1126891415);m=md5_ii(m,l,o,n,p[g+14],15,-1416354905);n=md5_ii(n,m,l,o,p[g+5],21,-57434055);o=md5_ii(o,n,m,l,p[g+12],6,1700485571);l=md5_ii(l,o,n,m,p[g+3],10,-1894986606);m=md5_ii(m,l,o,n,p[g+10],15,-1051523);n=md5_ii(n,m,l,o,p[g+1],21,-2054922799);o=md5_ii(o,n,m,l,p[g+8],6,1873313359);l=md5_ii(l,o,n,m,p[g+15],10,-30611744);m=md5_ii(m,l,o,n,p[g+6],15,-1560198380);n=md5_ii(n,m,l,o,p[g+13],21,1309151649);o=md5_ii(o,n,m,l,p[g+4],6,-145523070);l=md5_ii(l,o,n,m,p[g+11],10,-1120210379);m=md5_ii(m,l,o,n,p[g+2],15,718787259);n=md5_ii(n,m,l,o,p[g+9],21,-343485551);o=safe_add(o,j);n=safe_add(n,h);m=safe_add(m,f);l=safe_add(l,e)}return Array(o,n,m,l)}function md5_cmn(h,e,d,c,g,f){return safe_add(bit_rol(safe_add(safe_add(e,h),safe_add(c,f)),g),d)}function md5_ff(g,f,k,j,e,i,h){return md5_cmn((f&k)|((~f)&j),g,f,e,i,h)}function md5_gg(g,f,k,j,e,i,h){return md5_cmn((f&j)|(k&(~j)),g,f,e,i,h)}function md5_hh(g,f,k,j,e,i,h){return md5_cmn(f^k^j,g,f,e,i,h)}function md5_ii(g,f,k,j,e,i,h){return md5_cmn(k^(f|(~j)),g,f,e,i,h)}function core_hmac_md5(c,f){var e=str2binl(c);if(e.length>16){e=core_md5(e,c.length*chrsz)}var a=Array(16),d=Array(16);for(var b=0;b<16;b++){a[b]=e[b]^909522486;d[b]=e[b]^1549556828}var g=core_md5(a.concat(str2binl(f)),512+f.length*chrsz);return core_md5(d.concat(g),512+128)}function safe_add(a,d){var c=(a&65535)+(d&65535);var b=(a>>16)+(d>>16)+(c>>16);return(b<<16)|(c&65535)}function bit_rol(a,b){return(a<<b)|(a>>>(32-b))}function str2binl(d){var c=Array();var a=(1<<chrsz)-1;for(var b=0;b<d.length*chrsz;b+=chrsz){c[b>>5]|=(d.charCodeAt(b/chrsz)&a)<<(b%32)}return c}function binl2hex(c){var b=hexcase?"0123456789ABCDEF":"0123456789abcdef";var d="";for(var a=0;a<c.length*4;a++){d+=b.charAt((c[a>>2]>>((a%4)*8+4))&15)+b.charAt((c[a>>2]>>((a%4)*8))&15)}return d}function binl2b64(d){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var f="";for(var b=0;b<d.length*4;b+=3){var e=(((d[b>>2]>>8*(b%4))&255)<<16)|(((d[b+1>>2]>>8*((b+1)%4))&255)<<8)|((d[b+2>>2]>>8*((b+2)%4))&255);for(var a=0;a<4;a++){if(b*8+a*6>d.length*32){f+=b64pad}else{f+=c.charAt((e>>6*(3-a))&63)}}}return f};
Ext.define("Hc_Framework.model.CurrentUser",{extend:"Ext.data.Model",alias:"model.currentuser",fields:[{name:"userId",type:"int"},{name:"userCode"},{name:"userName"},{name:"password"},{name:"pwdModifyTime"},{name:"deptNo",type:"int"},{name:"isAdminGroup",type:"int"},{name:"checkMac",type:"int"},{name:"addressMac"},{name:"checkIp",type:"int"},{name:"addressIp",text:"IP地址"},{name:"mobileNo",text:"手机号"},{name:"email",text:"邮箱地址"},"deptName","version","sysid","basePath"],proxy:{type:"sessionstorage",id:"currentuser"}});
Ext.define("Hc_Framework.model.ItgApplication",{extend:"Ext.data.Model",alias:"model.itgapplication",fields:[{name:"appNo",text:"应用编号",type:"int"},{name:"appCode",text:"应用编码",type:"string"},{name:"appName",text:"应用名称",type:"string"},{name:"projectCode",text:"所属项目"},{name:"enableFlag",text:"启用状态",type:"int",defaultValue:1},{name:"appUrl",text:"应用url"},{name:"jsUrl",text:"jsUrl"},{name:"imageUrl",text:"图标路径"},{name:"imageName",text:"图标名称"},{name:"orderNo",text:"排列序号",type:"int"},{name:"creator",text:"建档人"},{name:"createTime",text:"建档时间"},{name:"modifier",text:"修改人"},{name:"modifyTime",text:"修改时间"},{name:"remarks",text:"备注"}],idProperty:"appNo",identifier:"negative"});
Ext.define("Hc_Framework.model.ItgLoginUser",{extend:Ext.data.Model,alias:"model.itgloginuser",fields:[{name:"userId",text:"用户ID",type:"int"},{name:"userCode",text:"用户编号"},{name:"userName",text:"用户名称"},{name:"enableFlag",text:"是否启用",type:"int"},{name:"password",text:"密码"},{name:"pwdLevelNo",text:"密码等级",type:"int"},{name:"pwdModifyTime",text:"密码更改日期"},{name:"deptNo",text:"部门编号",type:"int"},{name:"isAdminGroup",text:"是否管理员组",type:"int"},{name:"checkMac",text:"是否检查Mac地址",type:"int"},{name:"addressMac",text:"Mac地址"},{name:"checkIp",text:"是否检查IP",type:"int"},{name:"addressIp",text:"IP地址"},{name:"mobileNo",text:"手机号"},{name:"email",text:"邮箱地址"},{name:"creator",text:"创建人员"},{name:"createTime",text:"创建日期"},{name:"modifier",text:"更改人员"},{name:"modifyTime",text:"更改日期"},{name:"remarks",text:"备注"}],idProperty:"userId",identifier:"negative"});
Ext.define("Hc_Framework.model.ItgMenuList",{extend:"Ext.data.Model",fields:[{name:"menuNo",text:"菜单编号",type:"int"},{name:"menuName",text:"菜单名称",type:"string"},{name:"appNo",text:"应用编号",type:"int"},{name:"projectCode",text:"项目编号",type:"string"},{name:"moduleNo",text:"模块编号",type:"int"},{name:"enableFlag",text:"启用标识",type:"int"},{name:"parentMenuNo",text:"父级Id",type:"int"},{name:"searchCode",text:"查询码",type:"string"},{name:"levelNo",text:"层级",type:"int"},{name:"beginGroup",text:"",type:"int"},{name:"orderNo",text:"排序号",type:"int"},{name:"creator",text:"建档人",type:"string"},{name:"createTime",text:"建档时间"},{name:"modifier",text:"修改人",type:"string"},{name:"modifyTime",text:"修改时间"},{name:"remarks",text:"备注",type:"string"},{name:"leaf",convert:function(b,a){return a.get("moduleNo")?true:false}},{name:"children",defaultValue:[]}],idProperty:"menuNo",identifier:"negative"});
Ext.define("Hc_Framework.model.ItgModuleList",{extend:"Ext.data.Model",alias:"model.itgmodulelist",fields:[{name:"moduleNo",type:"int"},{name:"moduleCode"},{name:"moduleName"},{name:"projectCode"},{name:"appNo",type:"int"},{name:"enableFlag",type:"int",defaultValue:1},{name:"isReport",type:"int"},{name:"moduleUrl"},{name:"rightValue",type:"int"},{name:"hint"},{name:"creator"},{name:"createTime"},{name:"modifier"},{name:"modifyTime"},{name:"remarks"}]});
Ext.define("Hc_Framework.model.ItgProject",{extend:"Ext.data.Model",alias:"model.itgproject",fields:[{name:"projectCode",text:"项目编码"},{name:"projectName",text:"项目名称"},{name:"orderNo",text:"排列序号",type:"int"},{name:"enableFlag",text:"启用状态",type:"int"},{name:"creator",text:"建档人"},{name:"createTime",text:"建档时间"},{name:"modifier",text:"建档人"},{name:"modifyTime",text:"建档时间"},{name:"remarks",text:"备注"}],});
Ext.define("Hc_Framework.model.ItgRightList",{extend:Ext.data.Model,alias:"model.itgrightlist",fields:[{name:"rightId",text:"权限ID",type:"int"},{name:"projectCode",text:"项目代号"},{name:"rightNo",text:"权限编号"},{name:"rightName",text:"权限名称"},{name:"enableFlag",text:"启用",type:"int",defaultValue:1},{name:"rightType",text:"权限类型",type:"int"},{name:"orderNo",text:"排列序号",type:"int"},{name:"creator",text:"创建人员"},{name:"createTime",text:"创建日期"},{name:"modifier",text:"更改人员"},{name:"modifyTime",text:"更改日期"},{name:"remarks",text:"备注"}],idProperty:"rightId",identifier:"negative"});
Ext.define("Hc_Framework.model.ItgRoleList",{extend:Ext.data.Model,alias:"model.itgrolelist",fields:[{name:"roleId",text:"角色ID",type:"int"},{name:"roleName",text:"角色名称"},{name:"projectCode",text:"所属项目"},{name:"enableFlag",text:"是否启用",type:"int"},{name:"roleOwner",text:"角色拥有者"},{name:"orderNo",text:"排列序号",type:"int"},{name:"creator",text:"创建人员"},{name:"createTime",text:"创建日期"},{name:"modifier",text:"更改人员"},{name:"modifyTime",text:"更改日期"},{name:"remarks",text:"备注"},],idProperty:"roleId",identifier:"negative"});
Ext.define("Hc_Framework.model.ItgRoleRight",{extend:Ext.data.Model,alias:"model.itgroleright",fields:[{name:"roleRightId",text:"角色权限ID",type:"int"},{name:"roleId",text:"角色ID",type:"int"},{name:"rightValue",type:"int",defaultValue:0},{name:"hasRight",type:"boolean",convert:function(a,b){if(b.get("rightValue")>0){return true}return false}},{name:"moduleNo",type:"int"},{name:"creator",text:"创建人员"},{name:"createTime",text:"创建日期"},{name:"t2_moduleNo",type:"int"},{name:"moduleCode"},{name:"moduleName"},{name:"appNo",type:"int"},{name:"moduleUrl"},{name:"t2_rightValue",type:"int"}],idProperty:"roleRightId",identifier:"negative"});
Ext.define("Hc_Framework.model.ItgRoleUser",{extend:Ext.data.Model,alias:"model.itgroleuser",fields:[{name:"userRoleId",text:"用户角色ID",type:"int"},{name:"userId",text:"角色ID",type:"int"},{name:"roleId",text:"角色ID",type:"int"},{name:"userCode",text:"用户编号"},{name:"userName",text:"用户名称"},{name:"enableFlag",text:"是否启用",type:"int"},{name:"deptNo",text:"部门编号",type:"int"},{name:"isAdminGroup",text:"是否管理员组",type:"int"},{name:"addressMac",text:"Mac地址"},{name:"addressIp",text:"IP地址"},{name:"mobileNo",text:"手机号"},{name:"email",text:"邮箱地址"},{name:"remarks",text:"备注"},{name:"creator",text:"创建人员"},{name:"createTime",text:"创建日期"}],idProperty:"userRoleId",identifier:"negative"});
Ext.define("Hc_Framework.model.ItgUserPrivilege",{extend:"Ext.data.Model",alias:"model.itguserprivilege",fields:[{name:"userPrivilegeId",text:"特权编号",type:"int"},{name:"userId",text:"用户编号",type:"int"},{name:"moduleNo",text:"模块编号",type:"int"},{name:"moduleCode",text:"模块编号"},{name:"moduleName",text:"模块名称",type:"int"},{name:"rightValue",text:"模块权限值",type:"int"},{name:"addRightValue",text:"添加特权",type:"int"},{name:"subRightValue",text:"减少特权",type:"int"},{name:"creator",text:"等级",type:"int"},{name:"createTime",text:"分组",type:"int"},],idProperty:"userPrivilegeId",identifier:"negative"});
Ext.define("Hc_Framework.model.ItgUserRole",{extend:Ext.data.Model,alias:"model.itguserrole",fields:[{name:"userRoleId",text:"用户角色ID",type:"int"},{name:"userId",text:"角色ID",type:"int"},{name:"roleId",text:"角色ID",type:"int"},{name:"creator",text:"创建人员"},{name:"createTime",text:"创建日期"},{name:"remarks",text:"备注"},{name:"roleName",text:"角色名称"},{name:"roleOwner",text:"角色拥有者"},{name:"projectCode",text:"所属项目"},{name:"enableFlag",text:"是否启用",type:"int"}],idProperty:"userRoleId",identifier:"negative"});
Ext.define("Hc_Framework.model.LastVisit",{extend:"Ext.data.Model",fields:[{name:"menuNo",type:"int"},{name:"menuName"},{name:"moduleNo",type:"int"},{name:"moduleName"},{name:"moduleUrl"},{name:"mRight",type:"int"},{name:"uRight",type:"int"}]});
Ext.define("Hc_Framework.model.MainTree",{extend:"Ext.data.Model",fields:[{name:"menuNo",type:"int"},{name:"menuName"},{name:"modelNo",type:"int"},{name:"moduleName"},{name:"moduleUrl"},{name:"appUrl"},{name:"appCode"},{name:"jsUrl"},{name:"rightValue",type:"int"},{name:"rights",type:"int"},{name:"expanded",defaultValue:false}]});
Ext.define("Hc_Framework.store.CurrentUser",{extend:"Ext.data.Store",alias:"store.currentuser",storeId:"currentuser",model:"Hc_Framework.model.CurrentUser"});
Ext.define("Hc_Framework.store.ItgApplication",{extend:"Hc_Common.store.ComBase",alias:"store.itgapplication",model:"Hc_Framework.model.ItgApplication",proxy:{url:"itg_application/listAll.json?"}});
Ext.define("Hc_Framework.store.ItgDepartment",{extend:"Hc_Common.store.ComBase",alias:"store.itgdepartment",fields:["deptNo","deptName"],proxy:{url:"itg_department/listAll.json"}});
Ext.define("Hc_Framework.store.ItgProject",{extend:"Hc_Common.store.ComBase",alias:"store.itgproject",model:"Hc_Framework.model.ItgProject",proxy:{url:"itg_project/listAll.json"}});
Ext.define("Hc_Framework.store.LastVisit",{extend:"Ext.data.TreeStore",alias:"store.lastvisit",model:"Hc_Framework.model.LastVisit",autoLoad:true,autoSync:true,proxy:{type:"localstorage",id:"lastvisittree"},root:{id:0,text:"最近访问的模块",menuNo:0,menuName:"最近访问的模块",expanded:true}});
Ext.define("Hc_Framework.store.MainTree",{extend:"Ext.data.TreeStore",alias:"store.maintree",model:"Hc_Framework.model.MainTree",autoLoad:true,buffered:false,proxy:{type:"ajax",url:"itg_menu_list/getusermenulist.json",reader:{type:"json",rootProperty:"list"},root:{text:"hc",menuNo:1,menuName:"hc",expanded:true}},parentIdProperty:"parentMenuNo"});
Ext.define("Hc_Framework.store.MyFavorite",{extend:"Ext.data.TreeStore",alias:"store.myfavorite",model:"Hc_Framework.model.LastVisit",autoLoad:true,autoSync:true,proxy:{type:"ajax",url:"rest/myfavorite"},root:{id:0,text:"我的收藏夹",menuNo:0,menuName:"我的收藏夹",expanded:true}});
Ext.define("Hc_Framework.ux.ImportWin",{extend:"Ext.window.Window",alias:"widget.uximportwin",title:"批量导入数据",width:500,height:300,modal:true,layout:"fit",alwaysOnTop:true,closeAction:"destroy",items:[{xtype:"form",itemId:"userList",border:false}],bbar:["->",{xtype:"button",text:"确认",handler:"onChooseUserClick"},{xtype:"button",text:"取消",handler:function(){this.up("window").close()}}],initComponent:function(){this.callParent()}});
Ext.define("Hc_Framework.ux.ModuleList",{extend:"Ext.window.Window",alias:"widget.uxmodulelist",title:"模块清单",width:500,height:300,modal:true,layout:"fit",reference:"commonchildWin",closeAction:"hide",items:[{xtype:"grid",itemId:"moduleList",border:false,columns:[{header:"模块ID",dataIndex:"moduleNo"},{header:"模块编号",dataIndex:"moduleCode"},{header:"模块名称",dataIndex:"moduleName",flex:1},{header:"项目代号",dataIndex:"projectCode",width:50},{header:"系统ID",dataIndex:"appNo",width:50},{header:"权限值",dataIndex:"rightValue",width:50}],selType:"checkboxmodel",store:{type:"basestore",model:"Hc_Framework.model.ItgLoginUser",autoLoad:true,proxy:{url:Hc.basePath+"itg_module_list/list.json"}},bbar:{xtype:"pagingtoolbar",store:{type:"basestore",model:"Hc_Framework.model.ItgLoginUser",autoLoad:true,proxy:{url:Hc.basePath+"itg_module_list/list.json"}}}}],bbar:["->",{xtype:"button",text:"确认",handler:"onWinReturnValue"},{xtype:"button",text:"取消",handler:function(){this.up("window").close()}}],initComponent:function(){this.callParent()}});
Ext.define("Hc_Framework.ux.RoleList",{extend:"Ext.window.Window",alias:"widget.uxrolelist",title:"角色清单",width:500,height:300,modal:true,layout:"fit",alwaysOnTop:true,closeAction:"hide",targetStore:{},items:[{xtype:"grid",itemId:"roleList",border:false,columns:[{header:"角色名称",dataIndex:"roleName"},{header:"启用状态",dataIndex:"enableFlag",renderer:"renderUseFlag"},{header:"角色拥有者",dataIndex:"roleOwner",width:150},{header:"排列序号",dataIndex:"orderNo",width:80},{header:"备注",dataIndex:"remarks",flex:1}],selType:"checkboxmodel",store:{type:"basestore",model:"Hc_Framework.model.ItgLoginUser",autoLoad:true,proxy:{url:Hc.basePath+"itg_role_list/list.json"}},bbar:{xtype:"pagingtoolbar",store:{type:"basestore",model:"Hc_Framework.model.ItgLoginUser",autoLoad:true,proxy:{url:Hc.basePath+"itg_role_list/list.json"}}}}],bbar:["->",{xtype:"button",text:"确认",handler:"onWinReturnValue"},{xtype:"button",text:"取消",handler:function(){this.up("window").close()}}],scope:this,initComponent:function(){this.callParent()},onWinReturnValue:function(a){alert(a)}});
Ext.define("Hc_Framework.ux.UserList",{extend:"Ext.window.Window",alias:"widget.uxuserlist",title:"用户清单",width:500,height:300,modal:true,layout:"fit",alwaysOnTop:true,closeAction:"hide",targetStore:{},items:[{xtype:"grid",itemId:"userList",border:false,columns:[{dataIndex:"userCode",header:"用户编号"},{dataIndex:"userName",header:"用户名称",flex:1},{dataIndex:"enableFlag",header:"启用状态",renderer:"renderUseFlag",width:60},{dataIndex:"deptNo",header:"部门编号",width:60},{dataIndex:"isAdminGroup",header:"管理员组?",renderer:"renderYesNo",width:60}],selType:"checkboxmodel",store:{type:"basestore",model:"Hc_Framework.model.ItgLoginUser",autoLoad:true,proxy:{url:Hc.basePath+"itg_login_user/list.json"}},bbar:{xtype:"pagingtoolbar",store:{type:"basestore",model:"Hc_Framework.model.ItgLoginUser",autoLoad:true,proxy:{url:Hc.basePath+"itg_login_user/list.json"}}}}],bbar:["->",{xtype:"button",text:"确认",handler:"onWinReturnValue"},{xtype:"button",text:"取消",handler:function(){this.up("window").close()}}],initComponent:function(){this.callParent()}});
Ext.define("Hc_Framework.view.homepage.HomePage",{extend:"Ext.Container",alias:"widget.homepage",title:"首页",id:"app-homepage",layout:{type:"fit",align:"middle"},initComponent:function(){this.callParent()}});
Ext.define("Hc_Framework.view.itgapplication.ItgApplication",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.itgapplication",controller:"itgapplication",viewModel:{type:"itgapplication"},initComponent:function(){var b=this,a=Ext.create("Hc_Framework.store.ItgProject");Ext.apply(b,{searchItems:[{xtype:"extcombox",fieldLabel:"所属项目",name:"projectCode",store:a,displaymember:"projectName",valuemember:"projectCode"},{xtype:"textfield",fieldLabel:"应用编码",name:"appCode"},{xtype:"textfield",fieldLabel:"应用名称",name:"appName"},{xtype:"combouseflag",fieldLabel:"启用状态",name:"enableFlag"}],gridModel:"Hc_Framework.model.ItgApplication",gridColumns:[{dataIndex:"appNo",text:"应用编号",editor:{allowBlank:false}},{dataIndex:"appCode",text:"应用编码",editor:{allowBlank:false}},{dataIndex:"appName",text:"应用名称",editor:{allowBlank:false},width:160},{dataIndex:"projectCode",text:"所属项目",editor:{allowBlank:false},width:150,xtype:"bllookupedit",estore:a,gstore:a,displaymember:"projectName",valuemember:"projectCode"},{dataIndex:"appUrl",text:"系统url",editor:{allowBlank:false},width:160},{dataIndex:"jsUrl",text:"jsurl",editor:{allowBlank:false},width:180},{dataIndex:"enableFlag",text:"启用状态",type:"int",editor:{xtype:"combouseflag",allowBlank:false},renderer:"renderUseFlag",width:60},{dataIndex:"imageUrl",text:"图标路径",editor:true},{dataIndex:"imageName",text:"图标名称",editor:true},{dataIndex:"orderNo",text:"排列序号",type:"int",editor:{type:"numberfield"}},{header:"备注",dataIndex:"remarks",editor:true,width:135},{header:"建档人",dataIndex:"creator",width:100},{header:"建档时间",dataIndex:"createTime",width:135},{header:"修改人",dataIndex:"modifier",width:100},{header:"修改时间",dataIndex:"modifyTime",width:135}],gridPrimaryKey:"appNo",gridUnionKey:"",gridLoadUrl:Hc.basePath+"itg_application/list.json",gridSaveUrl:Hc.basePath+"itg_application/batchOperate.json",gridExportUrl:Hc.basePath+"itg_application/do_export.json",gridImportUrl:Hc.basePath+""});b.callParent()}});
Ext.define("Hc_Framework.view.itgapplication.ItgApplicationController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.itgapplication"});
Ext.define("Hc_Framework.view.itgapplication.ItgApplicationModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.itgapplication"});
Ext.define("Hc_Framework.view.itgloginuser.ItgLoginUser",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.itgloginuser",controller:"itgloginuser",viewModel:{type:"itgloginuser"},initComponent:function(c){var b=this;var a=Ext.create("Hc_Framework.store.ItgDepartment");Ext.apply(b,{searchItems:[{fieldLabel:"所属部门",name:"deptNo",xtype:"extcombox",store:a,displaymember:"deptName",valuemember:"deptNo"},{xtype:"textfield",fieldLabel:"用户账号",name:"userCode"},{xtype:"textfield",fieldLabel:"用户名称",name:"userName"},{xtype:"combouseflag",fieldLabel:"启用状态",name:"enableFlag"}],gridModel:"Hc_Framework.model.ItgLoginUser",gridColumns:[{dataIndex:"userCode",header:"用户账号",editor:{allowBlank:false,regex:/^[a-zA-Z0-9.@\-\_]+$/,regexText:"请输入字母、数字与.@-_特殊字符"}},{dataIndex:"userName",header:"用户名称",editor:{allowBlank:false}},{dataIndex:"password",header:"密码",editor:{allowBlank:false,inputType:"password"},renderer:function(){return"*"}},{dataIndex:"deptNo",header:"所属部门",editor:{allowBlank:false},width:160,xtype:"bllookupedit",estore:a,gstore:a,displaymember:"deptName",valuemember:"deptNo"},{dataIndex:"mobileNo",header:"手机号码",editor:true},{dataIndex:"email",header:"邮箱",editor:true,width:135,vtype:"email"},{dataIndex:"enableFlag",header:"启用状态",editor:{allowBlank:false},xtype:"bllookupedit",displayvalue:"0=禁用:1=启用",width:60},{header:"备注",dataIndex:"remarks",editor:true,width:135},{header:"建档人",dataIndex:"creator",width:100},{header:"建档时间",dataIndex:"createTime",width:135},{header:"修改人",dataIndex:"modifier",width:100},{header:"修改时间",dataIndex:"modifyTime",width:135}],gridPrimaryKey:"userCode",gridUnionKey:"",gridLoadUrl:Hc.basePath+"itg_login_user/list.json",gridSaveUrl:Hc.basePath+"itg_login_user/batchOperate.json",gridExportUrl:Hc.basePath+"itg_login_user/do_export.json",gridImportUrl:Hc.basePath+""});b.callParent(c)}});
Ext.define("Hc_Framework.view.itgloginuser.ItgLoginUserController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.itgloginuser",onGridAfterEdit:function(c,b){var d=b.value;var a=b.originalValue;this.callParent(arguments);if(b.field=="password"){if(d==a){return}else{var e=hex_md5(d);b.record.set("password",e)}}},onBtnCopyClick:function(e){var g=this,d=g.workObject,b=g.workObject.store,c=g.workObject.primaryKey,f=g.workObject.getSelection(),a;if(f.length<1){return}if(!d.isCanAdd||d.isReadOnly){Hc.alert("此网格不允许新增数据");return}if(d.isMaster&&this.editingList.length>0){Hc.alert("您有一笔数据正在处理，不能复制主表记录");return}Ext.Array.each(f,function(h){a=Ext.create(b.model);Ext.apply(a.data,h.data);a.set(c,"");a.set("_flag","A");a.set("password","");b.add(a)})}});
Ext.define("Hc_Framework.view.itgloginuser.ItgLoginUserModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.itgloginuser"});
Ext.define("Hc_Framework.view.itgmenu.ItgMenu",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.itgmenu",controller:"itgmenu",viewModel:{type:"itgmenu"},initComponent:function(){var a=this;a.gridEditModel="none";a.gridCanDrag=true;a.gridCanEdit=false;Ext.apply(a,{searchItems:[{xtype:"combo",width:"250",reference:"ddlProjectCode",editable:false,triggerAction:"all",fieldLabel:"项目编码",allowBlank:false,name:"projectCode",displayField:"projectName",valueField:"projectCode",store:{model:"Hc_Framework.model.ItgProject",type:"basestore",autoLoad:true,proxy:{url:Hc.basePath+"itg_project/list.json"}}}],gridModel:"Hc_Framework.model.ItgApplication",gridColumns:[{header:"模块ID",dataIndex:"moduleNo"},{header:"模块编号",dataIndex:"moduleCode"},{header:"模块名称",dataIndex:"moduleName",flex:1},{header:"项目代号",dataIndex:"projectCode",width:50},{header:"系统ID",dataIndex:"appNo",width:50},{header:"是否可用",dataIndex:"enableFlag"},{header:"是否报表",dataIndex:"isReport"},{header:"URL",dataIndex:"moduleUrl",width:140},{header:"权限值",dataIndex:"rightValue",width:50},{header:"备注",dataIndex:"remarks"}],gridPrimaryKey:"appCode",gridUnionKey:"",gridLoadUrl:Hc.basePath+"itg_module_list/list.json?inMenu=false"});a.otherItems=[{xtype:"treepanel",region:"west",split:true,reference:"menutree",width:200,batchUrl:Hc.basePath+"itg_menu_list/batchOperate.json",rootVisible:false,lines:true,columns:[{xtype:"treecolumn",flex:1,dataIndex:"menuName",text:"菜单名称",sortable:false,hideable:false}],store:{model:"Hc_Framework.model.ItgMenuList",type:"treebase",proxy:{type:"ajax",url:Hc.basePath+"itg_menu_list/list.json"},root:{id:0,menuName:"hc",menuNo:0,expanded:false},nodeParam:"parentMenuNo",parentIdProperty:"parentMenuNo"},listeners:{selectionchange:"onTreeSelectionChange"},viewConfig:{listeners:{render:function(b){var c=new Ext.dd.DropTarget(b.el,{ddGroup:"dd_commongrid",copy:false,notifyDrop:function(d,h,i){var g=a.lookupReference("menutree"),f=g.selection;if(!f){return true}if(f.isLeaf()){f=f.parentNode}var e=[];Ext.Array.each(i.records,function(j){e.push({menuName:j.data.moduleName,moduleNo:j.data.moduleNo,parentMenuNo:f.id,projectCode:f.data.projectCode,appNo:f.data.appNo,enableFlag:1,searchCode:f.data.searchCode,levelNo:f.data.levelNo+1,orderNo:f.data.orderNo})});a.controller.saveData({data:{insertList:e},srcObj:g});return true}})}}}},{xtype:"window",autoShow:false,closeAction:"hide",reference:"editWin",modal:true,items:[{xtype:"form",items:[{name:"appNo",fieldLabel:"应用编号",xtype:"numberfield"},{name:"menuName",fieldLabel:"菜单名称",xtype:"textfield"},{name:"searchCode",fieldLabel:"查询码",xtype:"textfield"},{name:"levelNo",fieldLabel:"层级",xtype:"numberfield"},{name:"orderNo",fieldLabel:"排序码",xtype:"numberfield"}],layout:{type:"table",columns:2},bodyPadding:10}],title:"新增菜单",bbar:["->",{xtype:"button",text:"确认",handler:"btnSaveMenu"},{xtype:"button",text:"取消",handler:function(b){b.up("window").close()}}]}];a.callParent()}});
Ext.define("Hc_Framework.view.itgmenu.ItgMenuController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.itgmenu",init:function(){var b=this,a=b.getObjList();b.workObject=a.menutree;if(a.btnUndo){a.btnUndo.setVisible(false)}if(a.btnCancel){a.btnCancel.setVisible(false)}if(a.btnSave){a.btnSave.setVisible(false)}if(a.btnAdd){delete a.btnAdd.menu}b.callParent(arguments)},beforeSearch:function(){var c=this.getObjList(),a=c.mastergrid.store,b=c.ddlProjectCode.getValue();a.proxy.extraParams.projectCode=b;a.reload()},btnSaveMenu:function(c){var f={},a=this.view.workObject,d=c.up("window").down("form"),b=d.getRecord(),e=d.getValues();if(b.phantom){e.parentMenuNo=b.data.parentMenuNo;e.projectCode=b.data.projectCode;e.enableFlag=1;f.insertList=[e]}else{f.updateList=[e]}this.saveData({srcObj:a,btn:c,data:f})},onBtnAddClick:function(){var d=this.lookupReference("ddlProjectCode").getValue();if(!d){Hc.alert("请选择项目编号");return}var e=this.lookupReference("editWin"),a=this.lookupReference("menutree"),c=a.store,b=Ext.create(c.model,{projectCode:d,parentMenuNo:a.selection?a.selection.id:0});e.show();e.down("form").loadRecord(b)},onBtnEditClick:function(){var b=this.lookupReference("editWin"),a=this.lookupReference("menutree").selection;if(a){b.show();b.down("form").loadRecord(a)}},onBtnCancelClick:function(){var a=this.getView().workObject;a.store.rejectChanges();a.view.refresh()},onBtnDeleteClick:function(b){var c=this,a=c.lookupReference("menutree"),d={deleteList:[{menuNo:a.selection.id}]};c.saveData({srcObj:a,btn:b,data:d})},onGridSelectionChange:function(){},onTreeSelectionChange:function(d,a){var b=this,c=b.getReferences();if(this.canDelete()&&c.btnDelete){c.btnDelete.setDisabled(a.length===0)}if(this.canPrint()&&c.btnPrint){c.btnPrint.setDisabled(a.length===0)}if(this.canEdit()&&c.btnEdit){c.btnEdit.setDisabled(a.length===0)}},afterSave:function(a,b){if(a.result.resultCode=="0"){b.srcObj.store.reload();b.srcObj.view.refresh()}else{Hc.alert(a.result.msg)}if(b.btn){b.btn.setDisabled(false);if(b.btn.up("window")){b.btn.up("window").close()}}else{this.lookupReference("mastergrid").store.reload()}}});
Ext.define("Hc_Framework.view.itgmenu.ItgMenuModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.itgmenu"});
Ext.define("Hc_Framework.view.itgmenulist.ItgMenuList",{extend:"Hc_Common.view.BaseTreePage",alias:"widget.itgmenulist",controller:"itgmenulist",viewModel:{type:"itgmenulist"},initComponent:function(){var a=this;a.tree.columns=[{dataIndex:"menuNo",text:"菜单编号",xtype:"treecolumn",width:200},{dataIndex:"menuName",text:"菜单名称"},{dataIndex:"appNo",text:"应用编号"},{dataIndex:"projectCode",text:"项目编号"},{dataIndex:"moduleNo",text:"模块编号"},{dataIndex:"enableFlag",text:"启用标识"},{dataIndex:"parentMenuNo",text:"父级Id"},{dataIndex:"searchCode",text:"查询码"},{dataIndex:"levelNo",text:"层级"},{dataIndex:"orderNo",text:"排序码"},{dataIndex:"creator",text:"创建人员"},{dataIndex:"createTime",text:"创建日期"},{dataIndex:"modifier",text:"更改人员"},{dataIndex:"modifyTime",text:"更改日期"},{dataIndex:"remarks",text:"备注"},];a.tree.batchUrl=Hc.basePath+"itg_menu_list/batchOperate.json";a.tree.autoLoad=true;a.detailItem=[{name:"menuNo",fieldLabel:"菜单编号",xtype:"numberfield",bind:{value:"{theRow.menuNo}"}},{name:"menuName",fieldLabel:"菜单名称",xtype:"textfield",bind:{value:"{theRow.menuName}"}},{name:"appNo",fieldLabel:"应用编号",xtype:"numberfield",bind:{value:"{theRow.appNo}"}},{name:"projectCode",fieldLabel:"项目编号",xtype:"textfield",bind:{value:"{theRow.projectCode}"}},{name:"moduleNo",fieldLabel:"模块编号",xtype:"numberfield",bind:{value:"{theRow.moduleNo}"}},{name:"enableFlag",fieldLabel:"启用标识",xtype:"combouseflag",bind:{value:"{theRow.enableFlag}"}},{name:"parentMenuNo",fieldLabel:"父级Id",xtype:"numberfield",bind:{value:"{theRow.parentMenuNo}"}},{name:"searchCode",fieldLabel:"查询码",xtype:"textfield",bind:{value:"{theRow.searchCode}"}},{name:"levelNo",fieldLabel:"层级",xtype:"numberfield",bind:{value:"{theRow.levelNo}"}},{name:"orderNo",fieldLabel:"排序码",xtype:"numberfield",bind:{value:"{theRow.orderNo}"}},{name:"creator",fieldLabel:"创建人员",xtype:"textfield",bind:{value:"{theRow.creator}"}},{name:"createTime",fieldLabel:"创建日期",xtype:"datefield",bind:{value:"{theRow.createTime}"}},{name:"modifier",fieldLabel:"更改人员",xtype:"textfield",bind:{value:"{theRow.modifier}"}},{name:"modifyTime",fieldLabel:"更改日期",xtype:"datefield",bind:{value:"{theRow.modifyTime}"}},{name:"remarks",fieldLabel:"备注",xtype:"textfield",bind:{value:"{theRow.remarks}"}}];a.otherItems=[{xtype:"uxmodulelist",autoShow:false}];a.callParent()}});
Ext.define("Hc_Framework.view.itgmenulist.ItgMenuListController",{extend:"Hc_Common.view.BaseTreePageController",alias:"controller.itgmenulist",initAddData:function(a,b){if(!a){return}a.set("projectCode","hc")},onAddChildClick:function(){var a=this.lookupReference("commonchildWin");a.show()},getWinData:function(e,c){if(!e||e.length<1){c.up("window").close();return}var f={},d=[],a,b=this.view.workObject.getSelectionModel().getSelection()[0];Ext.Array.each(e,function(g){a=new Object();a.menuNo=a.moduleNo=g.get("moduleNo");a.menuName=g.get("moduleName");a.appNo=b.get("appNo");a.projectCode=b.get("projectCode");a.enableFlag=1;a.parentMenuNo=b.get("menuNo");a.searchCode=0;a.levelNo=0;a.orderNo=2;d.push(a)});f.insertList=d;this.saveData(f,this.view.workObject,c)}});
Ext.define("Hc_Framework.view.itgmenulist.ItgMenuListModel",{extend:"Hc_Common.view.BaseTreePageModel",alias:"viewmodel.itgmenulist",stores:{commonstore:{model:"Hc_Framework.model.ItgMenuList",proxy:{type:"ajax",url:Hc.basePath+"itg_menu_list/list.json"},root:{id:0,menuName:"hc项目菜单",menuNo:0,expanded:true},nodeParam:"parentMenuNo",autoLoad:false,parentIdProperty:"parentMenuNo"}}});
Ext.define("Hc_Framework.view.itgmenulistnew.ItgMenuListNew",{extend:"Hc_Common.view.BasePage",alias:"widget.itgmenulistnew",controller:"itgmenulistnew",viewModel:{type:"itgmenulistnew"},layout:"border",toolbar:{xtype:"toolbar",itemId:"commontoolbar",reference:"commontoolbar",region:"north",items:[{text:"刷新",itemId:"btnRefresh",reference:"btnRefresh",handler:"onClickRefresh",glyph:Hc.Icon.btnRefresh}]},treePanel:{xtype:"panel",itemId:"treePanel",reference:"treePanel",title:"菜单树面板",width:200,region:"west",split:true,layout:"border",collapsible:true,items:[{xtype:"combo",reference:"projectCodeCombo",labelWidth:60,width:100,editable:false,region:"north",triggerAction:"all",fieldLabel:"所属项目",name:"projectCode",displayField:"projectName",valueField:"projectCode",queryMode:"local",store:{type:"itgproject",autoLoad:true},allowBlank:false,listeners:{change:"onChangeProjectCode"}},{xtype:"treepanel",itemId:"menuTree",region:"center",layout:"fit",reference:"menuTree",rootVisible:false,lines:true,columns:[{xtype:"treecolumn",flex:1,dataIndex:"menuName",text:"菜单",sortable:false,hideable:false}],bind:{store:"{menuTreeStore}"},batchUrl:Hc.basePath+"itg_menu_list/batchOperate.json"}]},detailPanel:{xtype:"panel",itemId:"detailPanel",reference:"detailPanel",region:"center",layout:"border",items:[{xtype:"form",itemId:"searchPanel",reference:"searchPanel",title:"查询模块",collapsible:true,region:"north",labelWidth:40,layout:{type:"table",columns:4},bodyPadding:4,align:"center",defaults:{labelAlign:"right",labelWidth:80,width:200},items:[{xtype:"textfield",fieldLabel:"模块编码",name:"moduleNo"},{xtype:"textfield",fieldLabel:"模块名称",name:"moduleName"},{xtype:"tbspacer",width:80,},{xtype:"button",text:"查询",handler:"onClickSearch",width:80,}]},{xtype:"panel",itemId:"operationPanel",reference:"operationPanel",region:"west",width:100,layout:{type:"vbox",pack:"start",align:"center"},defaults:{frame:true,width:80,height:30},items:[{xtype:"tbspacer",},{xtype:"button",text:"添加文件夹",handler:"addMenuFolder"},{xtype:"button",text:"移除文件夹",handler:"removeMenuFolder"},{xtype:"tbspacer",},{xtype:"tbspacer",},{xtype:"button",text:"添加模块<<",handler:"addModule"},{xtype:"button",text:"移除模块>>",handler:"removeModule"},{xtype:"tbspacer",},{xtype:"tbspacer",},{xtype:"button",text:"上移↑",handler:"moveUp"},{xtype:"button",text:"下移↓",handler:"moveDown"},{xtype:"button",text:"保存[移动]",handler:"moveSave"}]},{xtype:"grid",itemId:"dataGrid",reference:"dataGrid",region:"center",layout:"fit",columnLines:true,multiSelect:true,plugins:[{ptype:"cellediting",clicksToEdit:1}],bbar:{xtype:"pagingtoolbar",bind:{store:"{dataGridStore}"},displayInfo:true,listeners:{beforechange:"onBeforechange"}},viewConfig:{enableTextSelection:true},columns:[{header:"模块ID",dataIndex:"moduleNo",sortable:true,width:100},{header:"模块编号",dataIndex:"moduleCode",sortable:true,width:100},{header:"模块名称",dataIndex:"moduleName",sortable:true,width:200},{header:"所属系统",dataIndex:"appNo",sortable:true,width:140,xtype:"bllookupedit",displayvalue:"itg_application/listAll.json",displaymember:"appName",valuemember:"appNo",readOnly:true}],bind:{store:"{dataGridStore}"}}]},addWindow:{xtype:"window",title:"菜单名称",itemId:"addWindow",reference:"addWindow",width:200,height:100,layout:"fit",resizable:false,closeAction:"hide",plain:false,items:[{xtype:"form",bodyPadding:4,items:[{name:"menuName",fieldLabel:"",xtype:"textfield"}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{type:"vbox",align:"center"},items:[{xtype:"button",text:"确定",handler:"btnSaveMenu"}]}]},initComponent:function(){this.items=[this.toolbar,this.treePanel,this.detailPanel,this.addWindow];this.callParent()}});
Ext.define("Hc_Framework.view.itgmenulistnew.ItgMenuListNewController",{extend:"Hc_Common.view.BasePageController",alias:"controller.itgmenulistnew",init:function(){},onClickRefresh:function(){var a=this.lookupReference("projectCodeCombo").getValue();if(a==""||a==null){Ext.MessageBox.alert("提示","请选择所属项目！");return}this.reloadMenuTree(true);this.reloadDataGrid()},reloadMenuTree:function(a){var b=this.lookupReference("projectCodeCombo").getValue();var c=this.lookupReference("menuTree");c.store.proxy.extraParams.projectCode=b;c.store.root.data.expanded=true;if(a){c.store.load()}else{c.store.reload()}c.getView().refresh()},reloadDataGrid:function(){var d=this.lookupReference("projectCodeCombo").getValue();var b=this.lookupReference("dataGrid");var c=b.store;c.proxy.extraParams.projectCode=d;c.proxy.extraParams.inMenu=false;var a=this.lookupReference("searchPanel");if(a){var e=a.getValues();for(var f in e){if(e[f]!==""){c.proxy.extraParams[f]=e[f]}else{delete c.proxy.extraParams[f]}}}c.reload()},onBeforechange:function(b,c){var d=this.lookupReference("projectCodeCombo").getValue();c.projectCode=d;var a=this.lookupReference("searchPanel");if(a){var e=a.getValues();for(var f in e){if(e[f]!==""){c[f]=e[f]}}}},onChangeProjectCode:function(d,c,b){var a=c;this.reloadMenuTree(true);this.reloadDataGrid()},onClickSearch:function(){this.reloadDataGrid()},addMenuFolder:function(){var b=this.lookupReference("addWindow"),c=this.lookupReference("menuTree");var a=c.selection;if(a==null||!a.isLoaded()){Ext.MessageBox.alert("提示","未选中菜单文件夹节点或者该节点并未展开");return}b.show()},btnSaveMenu:function(a){this.doInsert(0,a)},removeMenuFolder:function(a){this.doDelete(0)},addModule:function(a){this.doInsert(1,a)},removeModule:function(a){this.doDelete(1)},doInsert:function(r,f){var p=this,q=[],a=this.lookupReference("menuTree"),j=a.selection;if(j==null){Ext.MessageBox.alert("提示","请选中菜单树节点");return}var o=j.data.searchCode,m=(j.childNodes!=null&&j.childNodes.length)||0,g={};if(r==0){var e=this.lookupReference("addWindow"),d=f.up("window").down("form"),n=d.getRecord(),l=d.getValues(),c=o+"-"+Ext.String.leftPad(m+1,2,"0");if(l.menuName==""){Ext.MessageBox.alert("提示","请输入菜单名称");e.close();return}q.push({menuName:l.menuName,parentMenuNo:j.id,projectCode:j.data.projectCode,appNo:j.data.appNo,enableFlag:1,searchCode:c,levelNo:j.data.levelNo+1,orderNo:m+1})}else{var b=this.lookupReference("dataGrid"),h=b.getSelectionModel().getSelection();if(h==null||h.length==0){Ext.MessageBox.alert("提示","请先选中所需添加的模块");return}if(j.data.leaf){Ext.MessageBox.alert("提示","叶子节点【模块】不能添加模块");return}var k=1;Ext.Array.each(h,function(s){var t=m+k,i=o+"-"+Ext.String.leftPad(m+k,2,"0");q.push({menuName:s.get("moduleName"),moduleNo:s.get("moduleNo"),parentMenuNo:j.id,projectCode:j.data.projectCode,appNo:j.data.appNo,enableFlag:1,searchCode:i,levelNo:j.data.levelNo+1,orderNo:t});k++})}if(q.length>0){g.insertList=q}Ext.Ajax.request({url:a.batchUrl,jsonData:JSON.stringify(g),method:"POST",success:function(s){var i=JSON.parse(s.responseText);if(i.result.resultCode=="0"){if(r==0){e.close()}(r==1&&p.reloadDataGrid())||(r==0&&e.close());p.reloadMenuTree()}else{Ext.MessageBox.alert("提示",i.result.msg)}}})},doDelete:function(b){var e=this,h=this.lookupReference("menuTree"),d=h.selection;if(d==null){Ext.MessageBox.alert("提示","请先选中所移除的节点");return}if((d.data.leaf&&b==0)||(!d.data.leaf&&b==1)){Ext.MessageBox.alert("提示","当前选中的节点与操作按钮的操作对象不匹配");return}if(b===0){var f=d.childNodes!=null&&d.childNodes.length;if(f>0){Ext.MessageBox.alert("提示","该菜单存在子节点，不能删除");return}}var a=d.parentNode;a.removeChild(d);var g={menuNo:d.id},c=Hc.basePath+"itg_menu_list/deleteById.json";Ext.Ajax.request({url:c,params:g,method:"POST",success:function(j){var i=JSON.parse(j.responseText);if(i.result.resultCode=="0"){b==1&&e.reloadDataGrid()}else{Ext.MessageBox.alert("提示",i.result.msg)}}})},moveUp:function(){var e=this,h=this.lookupReference("menuTree"),f=h.store,d=h.selection,c=d.data.index,a=d.parentNode;if(d==null){Ext.MessageBox.alert("提示","请先选中所需的节点");return}if(d.data.index==0){Ext.MessageBox.alert("提示","当前已为此级文件夹第一位置，无法上移");return}else{var g=d.previousSibling,b=c-1;a.insertBefore(d,g);d.dirty=true;d.data.orderNo=b+1;g.dirty=true;g.data.orderNo=c+1}},moveDown:function(){var f=this,h=this.lookupReference("menuTree"),g=h.store,e=h.selection,d=e.data.index,c=e.parentNode;if(e==null){Ext.MessageBox.alert("提示","请先选中所需的节点");return}if(e.data.index==c.childNodes.length-1){Ext.MessageBox.alert("提示","当前已为此级文件夹最后位置，无法下移");return}else{var b=e.nextSibling,a=d+1;c.insertBefore(b,e);e.dirty=true;e.data.orderNo=a+1;b.dirty=true;b.data.orderNo=d+1}},moveSave:function(){var c=this,g=this.lookupReference("menuTree"),e=g.store;var a=e.getModifiedRecords(),f={},d=[];if(a.length==0){Ext.MessageBox.alert("提示","不存在所修改的数据，无需保存");return}Ext.Array.each(a,function(i){var h={menuNo:i.data.menuNo,orderNo:i.data.orderNo};d.push(h)});f.updateList=d;var b=Hc.basePath+"itg_menu_list/batchOperate.json";Ext.Ajax.request({url:b,jsonData:JSON.stringify(f),method:"POST",success:function(i){var h=JSON.parse(i.responseText);if(h.result.resultCode=="0"){e.commitChanges();c.reloadMenuTree();Ext.toast("保存成功！")}else{Ext.MessageBox.alert("提示",h.result.msg)}}})}});
Ext.define("Hc_Framework.view.itgmenulistnew.ItgMenuListNewModel",{extend:"Hc_Common.view.BasePageModel",alias:"viewmodel.itgmenulistnew",stores:{menuTreeStore:{type:"treebase",model:"Hc_Framework.model.ItgMenuList",autoLoad:false,proxy:{type:"ajax",url:"itg_menu_list/listAll.json",},root:{id:0,text:"root",menuName:"root",menuNo:0,expanded:false},nodeParam:"parentMenuNo",parentIdProperty:"parentMenuNo"},dataGridStore:{type:"basestore",model:"Hc_Framework.model.ItgModuleList",proxy:{type:"ajax",url:"itg_module_list/list.json"},autoLoad:false}}});
Ext.define("Hc_Framework.view.itgmodule.ItgModuleList",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.itgmodulelist",controller:"itgmodulelist",viewModel:{type:"itgmodulelist"},initComponent:function(){var c=this,a=Ext.create("Hc_Framework.store.ItgProject"),d=Ext.create("Hc_Framework.store.ItgApplication"),b=Ext.create("Hc_Framework.store.ItgApplication");Ext.apply(c,{searchItems:[{xtype:"extcombox",fieldLabel:"所属系统",name:"appNo",store:d,displaymember:"appName",valuemember:"appNo"},{xtype:"textfield",fieldLabel:"模块编号",name:"moduleNo"},{xtype:"textfield",fieldLabel:"模块名称",name:"moduleName"},{xtype:"combouseflag",fieldLabel:"启用状态",name:"enableFlag"}],gridModel:"Hc_Framework.model.ItgModuleList",gridColumns:[{header:"模块编号",dataIndex:"moduleNo",editor:{xtype:"numberfield",allowBlank:false}},{header:"模块启动命令",dataIndex:"moduleCode",editor:{allowBlank:false},width:80},{header:"模块名称",dataIndex:"moduleName",editor:{allowBlank:false}},{header:"所属项目",dataIndex:"projectCode",width:140,editor:{allowBlank:false},xtype:"bllookupedit",estore:a,gstore:a,displaymember:"projectName",valuemember:"projectCode"},{header:"所属系统",dataIndex:"appNo",width:150,editor:{allowBlank:false},xtype:"bllookupedit",estore:b,gstore:d,displaymember:"appName",valuemember:"appNo"},{header:"URL",dataIndex:"moduleUrl",editor:{allowBlank:false}},{header:"权限值",dataIndex:"rightValue",editor:{xtype:"numberfield",allowBlank:false}},{dataIndex:"enableFlag",text:"启用状态",type:"int",editor:{xtype:"combouseflag",allowBlank:false},renderer:"renderUseFlag",width:60},{header:"是否报表",dataIndex:"isReport",editor:{xtype:"comboyesno"},renderer:"renderYesNo",width:60},{header:"备注",dataIndex:"remarks",editor:true,width:140},{header:"建档人",dataIndex:"creator",width:100},{header:"建档时间",dataIndex:"createTime",width:140},{header:"修改人",dataIndex:"modifier",width:100},{header:"修改时间",dataIndex:"modifyTime",width:140}],gridPrimaryKey:"moduleNo",gridUnionKey:"",gridLoadUrl:Hc.basePath+"itg_module_list/list.json",gridSaveUrl:Hc.basePath+"itg_module_list/batchOperate.json",gridExportUrl:Hc.basePath+"itg_module_list/do_export.json",gridImportUrl:Hc.basePath+""});c.callParent()}});
Ext.define("Hc_Framework.view.itgmodule.ItgModuleListController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.itgmodulelist",init:function(){var a=this;a.callParent()},onGridBeforeEdit:function(d,c){this.callParent(arguments);if(c.field=="appNo"){var b=c.record.get("projectCode"),a=c.column.getEditor().store;oldProjectCode=a.proxy.extraParams.projectCode;if(oldProjectCode!=b){a.proxy.extraParams.projectCode=b;a.reload()}}},onGridAfterEdit:function(c,b){this.callParent(arguments);if(b.field=="moduleNo"){var a=b.record.get("moduleNo"),d=b.record.get("moduleCode");if(!d){b.record.set("moduleCode",a)}}}});
Ext.define("Hc_Framework.view.itgmodule.ItgModuleListModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.itgmodulelist"});
Ext.define("Hc_Framework.view.itgproject.ItgProject",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.itgproject",controller:"itgproject",viewModel:{type:"itgproject"},initComponent:function(){var a=this;Ext.apply(a,{gridModel:"Hc_Framework.model.ItgProject",gridColumns:[{dataIndex:"projectCode",text:"项目编码",editor:{allowBlank:false}},{dataIndex:"projectName",text:"项目名称",editor:{allowBlank:false},width:160},{dataIndex:"enableFlag",text:"启用状态",type:"int",editor:{xtype:"combouseflag",allowBlank:false},renderer:"renderUseFlag",width:60},{dataIndex:"orderNo",text:"排列序号",editor:{xtype:"numberfield"}},{header:"备注",dataIndex:"remarks",editor:true,width:135},{header:"建档人",dataIndex:"creator",width:100},{header:"建档时间",dataIndex:"createTime",width:135},{header:"修改人",dataIndex:"modifier",width:100},{header:"修改时间",dataIndex:"modifyTime",width:135}],gridPrimaryKey:"projectCode",gridUnionKey:"",gridLoadUrl:Hc.basePath+"itg_project/list.json",gridSaveUrl:Hc.basePath+"itg_project/batchOperate.json",gridExportUrl:Hc.basePath+"itg_project/do_export.json",gridImportUrl:Hc.basePath+""});a.callParent()}});
Ext.define("Hc_Framework.view.itgproject.ItgProjectController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.itgproject"});
Ext.define("Hc_Framework.view.itgproject.ItgProjectModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.itgproject"});
Ext.define("Hc_Framework.view.itgright.ItgRightList",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.itgrightlist",controller:"itgrightlist",viewModel:{type:"itgrightlist"},initComponent:function(){var b=this,a=Ext.create("Hc_Framework.store.ItgProject");Ext.apply(b,{searchItems:[{xtype:"extcombox",fieldLabel:"所属项目",name:"projectCode",store:a,displaymember:"projectName",valuemember:"projectCode"},{xtype:"textfield",fieldLabel:"权限名称",name:"rightName"},{xtype:"combouseflag",fieldLabel:"启用状态",name:"enableFlag"}],gridModel:"Hc_Framework.model.ItgRightList",gridColumns:[{header:"权限值",dataIndex:"rightNo",editor:{allowBlank:false,xtype:"numberfield",minValue:1,onSpinUp:function(){var d=this,c=d.getValue()*2;if(!d.readOnly){d.setSpinValue(Ext.Number.constrain(c,d.minValue,d.maxValue))}},onSpinDown:function(){var d=this,c=d.getValue()/2;if(!d.readOnly){d.setSpinValue(Ext.Number.constrain(c,d.minValue,d.maxValue))}}}},{header:"权限名称",dataIndex:"rightName",editor:{allowBlank:false}},{dataIndex:"projectCode",text:"所属项目",editor:{allowBlank:false},width:150,xtype:"bllookupedit",estore:a,gstore:a,displaymember:"projectName",valuemember:"projectCode"},{header:"启用状态",dataIndex:"enableFlag",width:80,editor:{xtype:"combouseflag",allowBlank:false},renderer:"renderUseFlag"},{header:"排列序号",dataIndex:"orderNo",editor:{xtype:"numberfield"},width:80},{header:"备注",dataIndex:"remarks",editor:true,width:135},{header:"建档人",dataIndex:"creator",width:100},{header:"建档时间",dataIndex:"createTime",width:135},{header:"修改人",dataIndex:"modifier",width:100},{header:"修改时间",dataIndex:"modifyTime",width:135}],gridPrimaryKey:"appCode",gridUnionKey:"",gridLoadUrl:Hc.basePath+"itg_right_list/list.json",gridSaveUrl:Hc.basePath+"itg_right_list/batchOperate.json",gridExportUrl:Hc.basePath+"itg_right_list/do_export.json",gridImportUrl:Hc.basePath+""});b.callParent()}});
Ext.define("Hc_Framework.view.itgright.ItgRightListController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.itgrightlist"});
Ext.define("Hc_Framework.view.itgright.ItgRightListModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.itgrightlist"});
Ext.define("Hc_Framework.view.itgrole.ItgRoleList",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.itgrolelist",controller:"itgrolelist",viewModel:{type:"itgrolelist"},initComponent:function(){var b=this;var a=Ext.create("Hc_Framework.store.ItgProject");Ext.apply(b,{searchItems:[{fieldLabel:"所属项目",name:"projectCode",xtype:"extcombox",store:a,displaymember:"projectName",valuemember:"projectCode"},{xtype:"textfield",fieldLabel:"角色名称",name:"roleName"},{xtype:"textfield",fieldLabel:"角色拥有者",name:"roleOwner"},{xtype:"combouseflag",fieldLabel:"启用状态",name:"enableFlag"}],gridModel:"Hc_Framework.model.ItgRoleList",gridColumns:[{header:"角色名称",dataIndex:"roleName",editor:{allowBlank:false},width:120},{header:"所属项目",dataIndex:"projectCode",xtype:"bllookupedit",editor:{allowBlank:false},estore:a,gstore:a,displaymember:"projectName",valuemember:"projectCode",width:120},{header:"角色拥有者",dataIndex:"roleOwner",width:80},{dataIndex:"enableFlag",header:"启用状态",editor:{allowBlank:false},xtype:"bllookupedit",displayvalue:"0=禁用:1=启用",width:60},{header:"排列序号",dataIndex:"orderNo",editor:{xtype:"numberfield"},width:60},{header:"备注",dataIndex:"remarks",editor:true,flex:1},{header:"建档人",dataIndex:"creator",width:80},{header:"建档时间",dataIndex:"createTime",width:135},{header:"修改人",dataIndex:"modifier",width:80},{header:"修改时间",dataIndex:"modifyTime",width:135}],gridPrimaryKey:"roleId",gridLoadUrl:Hc.basePath+"itg_role_list/list.json",gridSaveUrl:Hc.basePath+"itg_role_list/batchOperate.json",gridExportUrl:Hc.basePath+"itg_role_list/do_export.json",gridImportUrl:Hc.basePath+""});b.callParent()}});
Ext.define("Hc_Framework.view.itgrole.ItgRoleListController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.itgrolelist"});
Ext.define("Hc_Framework.view.itgrole.ItgRoleListModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.itgrolelist"});
Ext.define("Hc_Framework.view.itgroleright.ItgRoleRight",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.itgroleright",controller:"itgroleright",viewModel:{type:"itgroleright"},customLayout:true,gridModel:"Hc_Framework.model.ItgRoleRight",gridPrimaryKey:"roleRightId",gridLoadUrl:Hc.basePath+"itg_role_right/getRoleRight.json",gridSaveUrl:Hc.basePath+"itg_role_right/batchOperate.json",gridExportUrl:Hc.basePath+"itg_role_right/do_export.json",gridImportUrl:Hc.basePath+"",oneclick:function(a,b){console.dir(b)},initComponent:function(){var e=this;var a=Ext.create("Hc_Framework.store.ItgApplication");var f={type:"checkboxmodel",mode:"MULTI",allowDeselect:true};e.grid.title="模块设置";Ext.apply(e,{searchItems:[{fieldLabel:"所属系统",name:"appNo",xtype:"extcombox",store:a,displaymember:"appName",valuemember:"appNo"},{xtype:"textfield",fieldLabel:"模块编号",name:"moduleCode"},{xtype:"textfield",fieldLabel:"模块名称",name:"moduleName"},{xtype:"comboyesno",fieldLabel:"是否有权限",name:"enableFlag"}],gridColumns:[{header:"是否有权限",dataIndex:"hasRight",xtype:"checkcolumn",},{header:"模块编号",dataIndex:"moduleCode",width:80},{header:"模块名称",dataIndex:"moduleName",width:100},{dataIndex:"appNo",header:"所属系统",width:120,xtype:"bllookupedit",readOnly:true,estore:a,gstore:a,displaymember:"appName",valuemember:"appNo"},{header:"URL",dataIndex:"moduleUrl",flex:1},{header:"分配人员",dataIndex:"creator",width:80},{header:"分配时间",dataIndex:"createTime",width:135}],});var b={xtype:"grid",reference:"rolegrid",width:330,region:"west",columns:[{text:"角色编号",dataIndex:"roleId",width:60},{text:"角色名称",dataIndex:"roleName",width:80},{text:"角色拥有者",dataIndex:"roleOwner",width:80},{text:"备注",dataIndex:"remarks",flex:1}],store:{type:"basestore",model:"Hc_Framework.model.ItgRoleList",autoLoad:true,proxy:{url:Hc.basePath+"itg_role_list/list.json"}},split:true,listeners:{selectionchange:"onSelectItemChange"}};var d={title:"模块权限",xtype:"panel",height:130,border:"false",region:"south",layout:"border",split:true,bodyStyle:"background:#fff; padding:10px;",items:[{xtype:"checkboxgroup",reference:"rightboxgroup",columns:4,boxLabel:"rightName",inputValue:"rightNo",items:[]}]};var c={xtype:"panel",border:"false",region:"center",layout:"border",items:[e.grid,d]};e.otherItems=[b,c,e.toolbar,e.searchPanel];e.items=e.otherItems;this.callParent()}});
Ext.define("Hc_Framework.view.itgroleright.ItgRoleRightController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.itgroleright",init:function(){var b=this;b.callParent(arguments);var a=b.getReferences();a.btnSearch.setDisabled(true);a.btnAdd.setVisible(false);a.btnDelete.setVisible(false);Ext.Ajax.request({url:Hc.basePath+"itg_right_list/listAll.json",method:"GET",params:{pageNum:0},success:function(c,d){var e=JSON.parse(c.responseText).list;var f=b.getObjList().rightboxgroup;Ext.Array.each(e,function(g){f.add({boxLabel:g.rightNo+" "+g.rightName,inputValue:g.rightNo,checked:false})})}});a.mastergrid.on("cellclick","gridCellClick")},initRowClass:function(b,d,e,c){var a=b.get("_flag");if(a=="A"){return"x-grid-rows-add"}if(a=="D"){return"x-grid-rows-edit"}if(b.dirty&&!a){return"x-grid-rows-edit"}return""},onSelectItemChange:function(f,d){var e=this,b=e.getReferences();b.mastergrid.enable();var c=this.lookupReference("rolegrid");var a=c.getSelectionModel().getSelection()[0];if(!a){b.btnSearch.setDisabled(true);return}b.btnSearch.setDisabled(false);this.onBtnSearchClick()},beforeSearch:function(a){var b=this.lookupReference("rolegrid");var c=b.getSelectionModel().getSelection()[0];if(!c){Ext.Msg.alert("系统提示","请选择角色");return}a.proxy.extraParams.roleId=c.get("roleId");return true},onBtnAddClick:function(){var a=this,b=a.lookupReference("rolegrid").getSelectionModel().getSelection()[0];if(!b){Ext.Msg.alert("系统提示","请选择角色");return}if(!a.win){a.win=Ext.widget("uxmodulelist")}a.win.show()},onBtnUndoClick:function(d){var c=this.workObject,b=c.store,a=c.getSelectionModel().getSelection();Ext.Array.each(a,function(e){if(e.phantom){b.remove(e)}else{e.reject();if(e.get("rightValue")>0){e.set("hasRight",true)}else{e.set("hasRight",false)}}})},onBtnCancelClick:function(d){var c=this.workObject,b=c.getStore(),a=b.getModifiedRecords();b.rejectChanges();Ext.Array.each(a,function(e){if(e.get("rightValue")>0){e.set("hasRight",true)}else{e.set("hasRight",false)}});c.view.refresh()},onGridSelectionChange:function(d,b,h,k){var m=this,n=m.getObjList();n.rightboxgroup.enable();var e=n.mastergrid;var g=e.getSelectionModel().getSelection()[0].get("rightValue");var c=e.getSelectionModel().getSelection()[0].get("t2_rightValue");var l=n.rightboxgroup;for(var f=0;f<l.items.length;f++){var o=l.items.getAt(f);o.un("change",m.boxchange,m);var a=(o.inputValue&c)===o.inputValue;var j=(o.inputValue&g)===o.inputValue;if(a){o.enable();if(j){o.setValue(true)}else{o.setValue(false)}}else{o.disable();o.setValue(false)}o.on("change",m.boxchange,m)}},boxchange:function(j,k,l,c){var t=this,a=t.getObjList();var h=a.rolegrid;var r=a.mastergrid;var p=a.rightboxgroup;var b=h.getSelectionModel().getSelection()[0];var d=r.getSelectionModel().getSelection()[0];if(!b){Ext.Msg.alert("系统提示","请选择角色");return}if(!d){Ext.Msg.alert("系统提示","请选择模块");return}var e=d.get("roleRightId");var s=d.get("rightValue");var f=j.inputValue;if(k){var m=f|s;if(e<0&&s==0){d.set("rightValue",m);d.set("_flag","A");d.set("moduleNo",d.get("t2_moduleNo"));d.set("roleId",b.get("roleId"))}else{if(d.get("_flag")=="D"){d.reject();d.set("rightValue",m)}else{d.set("rightValue",m)}}if(f!=1){for(var o=0;o<p.items.length;o++){var q=p.items.getAt(o);if(q.inputValue==1&&q.getValue()==false){q.setValue(true);break}}}}else{var g=f^s;if(g==0){if(e>0){d.set("_flag","D");d.set("rightValue",0)}else{d.reject()}}else{d.set("rightValue",g)}var n=true;for(var o=0;o<p.items.length;o++){var q=p.items.getAt(o);if(q.inputValue!=1&&q.getValue()==true){n=false;break}}if(n){for(var o=0;o<p.items.length;o++){var q=p.items.getAt(o);if(q.inputValue==1&&q.getValue()==true){q.setValue(false);break}}}}d.set("hasRight",false)},gridCellClick:function(f,b,n,g,m,p,h,j){if(n==0){var l=this,o=l.getObjList();var a=o.rolegrid;var k=o.rightboxgroup;var r=a.getSelectionModel().getSelection()[0];if(!r){Ext.Msg.alert("系统提示","请选择角色");return}var c=g.get("t2_rightValue");var q=g.get("rightValue");if(q==c){for(var d=0;d<k.items.length;d++){var s=k.items.getAt(d);s.setValue(false)}}else{for(var d=0;d<k.items.length;d++){var s=k.items.getAt(d);if(s.inputValue&c){s.setValue(true)}}}}}});
Ext.define("Hc_Framework.view.itgroleright.ItgRoleRightModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.itgroleright"});
Ext.define("Hc_Framework.view.itgroleuser.ItgRoleUser",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.itgroleuser",controller:"itgroleuser",viewModel:{type:"itgroleuser"},customLayout:true,gridModel:"Hc_Framework.model.ItgRoleUser",gridPrimaryKey:"userRoleId",gridLoadUrl:Hc.basePath+"itg_role_user/getUser.json?isExist=true",gridSaveUrl:Hc.basePath+"itg_role_user/batchOperate.json",gridExportUrl:Hc.basePath+"itg_role_user/do_export.json",gridImportUrl:Hc.basePath+"",initComponent:function(){var d=this;d.grid.title="已分配用户";var b=Ext.create("Hc_Framework.store.ItgDepartment");Ext.apply(d,{searchItems:[{fieldLabel:"所属部门",name:"deptNo",xtype:"extcombox",store:b,displaymember:"deptName",valuemember:"deptNo"},{xtype:"textfield",fieldLabel:"用户编号",name:"userCode"},{xtype:"textfield",fieldLabel:"用户名称",name:"userName"},{xtype:"combouseflag",fieldLabel:"启用状态",name:"enableFlag"}],gridColumns:[{dataIndex:"userCode",header:"用户编号",width:80},{dataIndex:"userName",header:"用户名称",width:80},{dataIndex:"deptNo",header:"所属部门",width:160,xtype:"bllookupedit",readOnly:true,estore:b,gstore:b,displaymember:"deptName",valuemember:"deptNo"},{dataIndex:"enableFlag",header:"启用状态",readOnly:true,xtype:"bllookupedit",displayvalue:"0=禁用:1=启用",width:60},{dataIndex:"creator",header:"分配人员",width:80},{dataIndex:"createTime",header:"分配时间",width:135},{dataIndex:"remarks",header:"备注",flex:1}]});var c={xtype:"grid",reference:"rolegrid",width:330,region:"west",columns:[{text:"角色名称",dataIndex:"roleName",flex:0.4},{text:"角色拥有者",dataIndex:"roleOwner",flex:0.2},{text:"备注",dataIndex:"remarks",flex:0.3}],store:{type:"basestore",model:"Hc_Framework.model.ItgRoleList",autoLoad:true,proxy:{url:Hc.basePath+"itg_role_list/list.json"}},split:true,listeners:{selectionchange:"onSelectChange"}};var a={xtype:"container",border:"false",region:"center",layout:"border",items:[{title:"未分配用户",xtype:"grid",reference:"notusergrid",columnLines:true,split:true,columns:[{dataIndex:"userCode",header:"用户编号",width:80},{dataIndex:"userName",header:"用户名称",width:80},{dataIndex:"deptNo",header:"所属部门",width:160,xtype:"bllookupedit",readOnly:true,estore:b,gstore:b,displaymember:"deptName",valuemember:"deptNo"},{dataIndex:"enableFlag",header:"启用状态",readOnly:true,xtype:"bllookupedit",displayvalue:"0=禁用:1=启用",width:60},{dataIndex:"creator",header:"创建者",width:80},{dataIndex:"createTime",header:"创建日期",width:135},{dataIndex:"remarks",header:"备注",flex:1}],region:"north",height:300,bind:{store:"{store2}"},plugins:[],selModel:{mode:"MULTI",allowDeselect:true},bbar:{xtype:"pagingtoolbar",plugins:Ext.create("Ext.ux.ComboPageSize"),displayInfo:true,bind:{store:"{store2}"}},listeners:{selectionchange:"onNotUserGridSelectionChange"},viewConfig:{enableTextSelection:true}},d.grid]};d.otherItems=[c,a,d.toolbar,d.searchPanel];d.items=d.otherItems;d.callParent()}});
Ext.define("Hc_Framework.view.itgroleuser.ItgRoleUserController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.itgroleuser",init:function(){this.callParent(arguments);var a=this.getReferences();a.btnAdd.setDisabled(true);a.btnDelete.setDisabled(true)},onSelectChange:function(e){var d=this,b=d.getReferences();var c=d.lookupReference("rolegrid");var a=c.getSelectionModel().getSelection()[0];if(!a){b.notusergrid.store.removeAll();b.notusergrid.disable();b.mastergrid.store.removeAll();b.mastergrid.disable();b.btnSearch.setDisabled(true);return}b.btnSearch.setDisabled(false);b.btnAdd.setDisabled(true);b.btnDelete.setDisabled(true);b.notusergrid.enable();b.mastergrid.enable();d.onBtnSearchClick()},beforeSearch:function(h){var e=this;var a=e.lookupReference("rolegrid");var d=a.getSelectionModel().getSelection()[0];if(!d){return}var c=d.get("roleId");h.proxy.extraParams.roleId=c;var f=e.lookupReference("notusergrid").store;f.proxy.extraParams.roleId=c;var b=e.lookupReference("commonsearch");if(b){var i=b.getValues();for(var g in i){if(i[g]!==""){f.proxy.extraParams[g]=i[g]}else{delete f.proxy.extraParams[g]}}}f.load();return true},onNotUserGridSelectionChange:function(){var b=this,a=b.getReferences();a.btnAdd.setDisabled(false)},onGridSelectionChange:function(){var b=this,a=b.getReferences();a.btnDelete.setDisabled(false)},onBtnAddClick:function(){var f=this;var d=f.lookupReference("notusergrid");var h=d.getSelectionModel().getSelection();if(h==null||h.length<=0){Ext.Msg.alert("系统提示","请选择未分配用户");return}var c=f.lookupReference("rolegrid");var g=c.getSelectionModel().getSelection()[0];if(!g){Ext.Msg.alert("系统提示","请选择角色");return}var b=g.get("roleId");var e=f.lookupReference("mastergrid");Ext.Array.each(h,function(i){i.data._flag="A";i.data.roleId=b;var j=Ext.create(e.store.model);Ext.apply(j.data,i.data);e.store.insert(0,j);d.store.remove(i)});var a=f.getReferences();a.btnSave.setDisabled(false)},onBtnDeleteClick:function(c){var d=this,f=d.workObject,b=f.getStore(),e=false,a=f.getSelectionModel().getSelection();if(a.length<1){Ext.Msg.alert("系统提示","请选择已分配用户");return}if(!d.checkDelete(a)===false){return}Ext.Array.each(a,function(g){var j=g.get("_flag");if(j=="A"){var h=d.lookupReference("notusergrid");var i=Ext.create(h.store.model);Ext.apply(i.data,g.data);h.store.insert(0,i);b.remove(g)}else{g.set("_flag","D");e=true}});if(e){f.view.refresh()}},afterSave:function(a,b){var c=this;if(a.result.resultCode=="0"){objList=c.getReferences();objList.btnSave.setDisabled(true);objList.notusergrid.store.reload({afterSaveData:true});objList.mastergrid.store.reload({afterSaveData:true})}else{Hc.alert(a.result.msg)}c.callParent(arguments)}});
Ext.define("Hc_Framework.view.itgroleuser.ItgRoleUserModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.itgroleuser",stores:{store2:{type:"basestore",model:"Hc_Framework.model.ItgRoleList",proxy:{url:Hc.basePath+"itg_role_user/getUser.json?isExist=false"}}}});
Ext.define("Hc_Framework.view.itgroleuser.ItgUserRole",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.itguserrole",controller:"itguserrole",viewModel:{type:"itguserrole"},customLayout:true,gridModel:"Hc_Framework.model.ItgUserRole",gridPrimaryKey:"userRoleId",gridLoadUrl:Hc.basePath+"itg_user_role/getRole.json?isExist=true",gridSaveUrl:Hc.basePath+"itg_user_role/batchOperate.json",gridExportUrl:Hc.basePath+"itg_user_role/do_export.json",gridImportUrl:Hc.basePath+"",initComponent:function(){var d=this;var c=Ext.create("Hc_Framework.store.ItgProject");Ext.apply(d,{searchItems:[{fieldLabel:"所属项目",name:"projectCode",xtype:"extcombox",store:c,displaymember:"projectName",valuemember:"projectCode"},{xtype:"textfield",fieldLabel:"角色名称",name:"roleName"},{xtype:"textfield",fieldLabel:"角色拥有者",name:"roleOwner"},{xtype:"combouseflag",fieldLabel:"启用状态",name:"enableFlag"}],gridColumns:[{dataIndex:"roleName",header:"角色名称",width:80},{dataIndex:"roleOwner",header:"角色拥有者",width:80},{header:"所属项目",dataIndex:"projectCode",xtype:"bllookupedit",readOnly:true,estore:c,gstore:c,displaymember:"projectName",valuemember:"projectCode",width:120},{dataIndex:"enableFlag",header:"启用状态",readOnly:true,xtype:"bllookupedit",displayvalue:"0=禁用:1=启用",width:60},{dataIndex:"creator",header:"分配人员",width:80},{dataIndex:"createTime",header:"分配时间",width:135},{dataIndex:"remarks",header:"备注",flex:1}]});d.grid.title="已分配角色";var e={title:"未分配角色",xtype:"grid",reference:"notrolegrid",columnLines:true,split:true,columns:[{dataIndex:"roleName",header:"角色名称",width:80},{dataIndex:"roleOwner",header:"角色拥有者",width:80},{header:"所属项目",dataIndex:"projectCode",xtype:"bllookupedit",readOnly:true,estore:c,gstore:c,displaymember:"projectName",valuemember:"projectCode",width:120},{dataIndex:"enableFlag",header:"启用状态",readOnly:true,xtype:"bllookupedit",displayvalue:"0=禁用:1=启用",width:60},{dataIndex:"creator",header:"创建者",width:80},{dataIndex:"createTime",header:"创建日期",width:135},{dataIndex:"remarks",header:"备注",flex:1}],region:"north",height:350,bind:{store:"{store2}"},plugins:[],selModel:{mode:"MULTI",allowDeselect:true},bbar:{xtype:"pagingtoolbar",plugins:Ext.create("Ext.ux.ComboPageSize"),displayInfo:true,bind:{store:"{store2}"}},listeners:{selectionchange:"onNotUserGridSelectionChange"},viewConfig:{enableTextSelection:true}};var b={xtype:"container",border:"false",region:"center",layout:"border",items:[e,d.grid]};var a={xtype:"treepanel",reference:"usertree",width:330,region:"west",columns:[{text:"部门",dataIndex:"text",flex:1,xtype:"treecolumn"}],store:{type:"treebase",proxy:{url:Hc.basePath+"itg_user_role/getNodeByDeptNo.json",reader:{type:"json",rootProperty:"children",totalProperty:"totalCount"}},root:{id:0,text:"hc",expanded:false}},split:true,listeners:{selectionchange:"onSelectChange",}};d.otherItems=[a,b,d.toolbar,d.searchPanel];d.items=d.otherItems;d.callParent()}});
Ext.define("Hc_Framework.view.itgroleuser.ItgUserRoleController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.itguserrole",init:function(){var a=this.getReferences();a.btnAdd.setDisabled(true);a.btnDelete.setDisabled(true);this.callParent()},onSelectChange:function(d){var c=this,a=c.getReferences();var e=c.lookupReference("usertree");var b=e.getSelectionModel().getSelection()[0];if(b){if(b.get("leaf")==true){a.btnSearch.setDisabled(false);a.notrolegrid.enable();a.mastergrid.enable();this.onBtnSearchClick()}else{a.btnSearch.setDisabled(true);a.notrolegrid.store.removeAll();a.mastergrid.store.removeAll()}}a.btnAdd.setDisabled(true);a.btnDelete.setDisabled(true)},beforeSearch:function(c){var d=this.lookupReference("usertree");var f=d.getSelectionModel().getSelection()[0];if(!f||f.get("leaf")!=true){return}var h=Ext.util.Format.substr(f.get("id"),1,f.get("id").length);c.proxy.extraParams.userId=h;var a=this.lookupReference("notrolegrid").store;a.proxy.extraParams.userId=h;var b=this.lookupReference("commonsearch");if(b){var e=b.getValues();for(var g in e){if(e[g]!==""){a.proxy.extraParams[g]=e[g]}else{delete a.proxy.extraParams[g]}}}a.load();return true},onBtnAddClick:function(){var f=this;var h=f.lookupReference("notrolegrid");var d=h.getSelectionModel().getSelection();if(d==null||d.length<=0){Ext.Msg.alert("系统提示","请选择角色");return}var e=f.lookupReference("mastergrid");var g=f.lookupReference("usertree");var b=g.getSelectionModel().getSelection()[0];if(!b){Ext.Msg.alert("系统提示","请选择用户");return}var c=Ext.util.Format.substr(b.get("id"),1,b.get("id").length);Ext.Array.each(d,function(k){k.data._flag="A";var j=f.lookupReference("usertree");k.data.userId=c;var i=Ext.create(e.store.model);Ext.apply(i.data,k.data);e.store.insert(0,i);h.store.remove(k)});var a=f.getReferences();a.btnSave.setDisabled(false)},onBtnDeleteClick:function(c){var d=this,f=d.workObject,b=f.getStore(),e=false,a=f.getSelectionModel().getSelection();if(a.length<1){return}if(!d.checkDelete(a)===false){return}Ext.Array.each(a,function(g){var j=g.get("_flag");if(j=="A"){var i=d.lookupReference("notrolegrid");var h=Ext.create(i.store.model);Ext.apply(h.data,g.data);i.store.insert(0,h);b.remove(g)}else{g.set("_flag","D");e=true}});if(e){f.view.refresh()}},onNotUserGridSelectionChange:function(){var b=this,a=b.getReferences();a.btnAdd.setDisabled(false)},onGridSelectionChange:function(){var b=this,a=b.getReferences();a.btnDelete.setDisabled(false)},afterSave:function(b,c){var d=this,a=d.getReferences();a.btnSave.setDisabled(true);a.notrolegrid.store.load();a.mastergrid.store.load()},afterSave:function(b,c){var d=this;if(b.result.resultCode=="0"){var a=d.getReferences();a.btnSave.setDisabled(true);a.notrolegrid.store.reload({afterSaveData:true});a.mastergrid.store.reload({afterSaveData:true})}else{Hc.alert(b.result.msg)}d.callParent(arguments)}});
Ext.define("Hc_Framework.view.itgroleuser.ItgUserRoleModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.itguserrole",stores:{store2:{type:"basestore",model:"Hc_Framework.model.ItgUserRole",proxy:{url:Hc.basePath+"itg_user_role/getRole.json?isExist=false"}}}});
Ext.define("Hc_Framework.view.itguserprivilege.ItgUserPrivilege",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.itguserprivilege",controller:"itguserprivilege",viewModel:{type:"itguserprivilege"},initComponent:function(){var a=this;a.gridModel="Hc_Framework.model.ItgUserPrivilege";a.gridColumns=[{dataIndex:"moduleNo",header:"模块ID"},{dataIndex:"moduleCode",header:"模块编号"},{dataIndex:"moduleName",header:"模块编号",width:60},{dataIndex:"rightValue",header:"模块权限值",flex:1},{dataIndex:"addRightValue",header:"添加特权",width:60},{dataIndex:"rightValue",header:"减少特权",flex:1},{dataIndex:"creator",header:"分配人员",width:70},{dataIndex:"createTime",header:"分配日期",xtype:"datecolumn",format:"Y-m-d",width:70},];a.gridLoadUrl=Hc.basePath+"itguserprivilege/list.json";a.gridSaveUrl=Hc.basePath+"itguserprivilege/save.json";a.otherItems=[{xtype:"grid",reference:"usergrid",width:150,region:"west",split:true,columns:[{text:"用户编号",dataIndex:"userCode",flex:0.5},{text:"用户名称",dataIndex:"userName",flex:0.5}],listeners:{selectionchange:"onSelectChange"}}];a.searchItems=[{xtype:"textfield",name:"creator",fieldLabel:"创建人员"}];a.callParent()}});
Ext.define("Hc_Framework.view.itguserprivilege.ItgUserPrivilegeController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.itguserprivilege",onSelectChange:function(a){this.onBtnSearchClick()},onBtnAddClick:function(){var b=this,a=b.lookupReference("usergrid").getSelectionModel().getSelection();if(a.length<1){Ext.Msg.alert("系统提示","请选择角色");return}if(!b.win){b.win=Ext.widget("uxrolelist")}b.win.show()},onChooseUserClick:function(d){var f=this,b=f.lookupReference("usergrid").getSelectionModel().getSelection()[0].get("userId"),e=f.win.getComponent("roleList").getSelectionModel().getSelection(),a=f.getView().workObject.getStore(),c=a.getModel();Ext.Array.each(e,function(g){if(a.findBy(function(h){return h.data.roleId==g.data.roleId})==-1){a.insert(0,new c({userId:b,roleId:g.data.roleId,roleName:g.data.roleName,roleOwner:g.data.roleOwner,enableFlag:g.data.enableFlag,remarks:g.data.remarks,_flag:"A"}))}});f.win.close()},customFilter:function(b,a){var c=this.lookupReference("usergrid").getSelection();if(c.length<1){return false}a.push({property:"userId",value:c[0].get("userId")});return true}});
Ext.define("Hc_Framework.view.itguserprivilege.ItgUserPrivilegeModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.itguserprivilege"});
Ext.define("Hc_Framework.view.uchome.HomePage",{extend:"Ext.Container",alias:"widget.homepage",title:"首页",id:"app-homepage",layout:{type:"fit",align:"middle"},initComponent:function(){this.callParent()}});
Ext.define("Hc_Framework.view.uclogin.Login",{extend:"Ext.window.Window",viewModel:"login",controller:"login",modal:true,bodyPadding:10,title:"用户登录",closable:false,autoShow:true,cls:"login",width:500,height:300,items:{xtype:"form",reference:"form",baseCls:"x-plain",items:[{xtype:"textfield",name:"usercode",fieldLabel:"用户名",allowBlank:false,enableKeyEvents:true,listeners:{specialKey:"onSpecialKey"}},{xtype:"textfield",name:"password",inputType:"password",fieldLabel:"密码",allowBlank:false,enableKeyEvents:true,cls:"password",listeners:{specialKey:"onSpecialKey"}}]},buttons:[{text:"登录",listeners:{click:"onLoginbtnClick"}}]});
Ext.define("Hc_Framework.view.uclogin.LoginController",{extend:"Ext.app.ViewController",alias:"controller.login",onLoginbtnClick:function(){var c=this,b=c.lookupReference("form"),a=b.getValues();if(!b.isValid()){return}Ext.Ajax.request({url:"/login.json",method:"POST",params:a,success:function(d,e){console.info("执行了额咩有");c.onSuccess(a,Ext.decode(d.responseText))}});this.onSuccess(a,{username:"吴德锋"})},onSpecialKey:function(b,a){if(a.getKey()===a.ENTER){this.onLoginbtnClick()}},onSuccess:function(d,a){var c=this,e=a.username,b=Ext.create("Hc_Framework.model.CurrentUser",{userCode:d.usercode,userName:e});b.save();c.getView().destroy();Ext.create("Hc_Framework.view.main.Main",{viewModel:{data:{system:{username:e}}}})}});
Ext.define("Hc_Framework.view.uclogin.LoginModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.login",data:{userCode:"wu.df"}});
Ext.define("Hc_Framework.view.ucmain.Main",{extend:"Ext.container.Viewport",id:"mainpage",xtype:"app-main",controller:"main",viewModel:{type:"main"},layout:"border",items:[{xtype:"maintop",region:"north",height:100},{region:"west",width:180,split:true,collapsible:true,collapseMode:"mini",title:"导航菜单",layout:"fit",items:[{xtype:"leftmenu"}]},{region:"center",xtype:"maincenter"}],initComponent:function(){console.info("这是我们的Main");Ext.setGlyphFontFamily("FontAwesome");this.callParent()}});
Ext.define("Hc_Framework.view.ucmain.MainController",{extend:"Ext.app.ViewController",alias:"controller.main",init:function(){console.info("这是我们的MainControlle1");this.checkActiveUser();this.callParent()},checkActiveUser:function(){var c=this,d=c.getViewModel();var a=Ext.create("Hc_Framework.store.CurrentUser");a.load();var b=a.getAt(0);console.info("uselsdsd");console.info(b);console.info(b.get("userName"));if(b){d.set("currentUser",b);d.set("system.version",b.get("version"));d.set("system.name",b.get("sysid"));return}Ext.Ajax.request({url:"getCurrentLoginUser.json",success:function(e){console.info("执行成功了没有");var g=JSON.parse(e.responseText);if(!g.result){Hc.alert("获取用户信息出错",function(){c.loginOut()});return}if(g.result.resultCode==0){var f=Ext.create(a.model);Ext.apply(f.data,g.entity);f.set("version",g.version);f.set("sysid",g.env);f.save();a.add(f);a.sync(true);d.set("currentUser",f);d.set("system.version",f.get("version"));d.set("system.name",f.get("sysid"))}else{var h=g.result.msg||"获取用户信息出错";Hc.alert(h,function(){c.loginOut()})}},failure:function(){Hc.alert("访问系统出错",function(){c.loginOut()})}})},onExitButtonClick:function(b){var a=this;Hc.confirm("确认退出当前用户？",function(c){if(c=="yes"){a.loginOut()}})},getUserInfo:function(){return this.getViewModel().get("currentUser")||{}},loginOut:function(){var a=Ext.create("Hc_Framework.store.CurrentUser");a.load();var b=a.getAt(0);if(b){b.erase();b.save()}a.sync(true);location.href=Hc.basePath+"logout.json"},onSearchModule:function(d){var a=this.getView().down("maintree").getStore(),c=d.getValue(),b;if(c==""){return}b=a.findRecord("moduleNo",c,0,false,false,true);if(!b||!b.data.leaf){b=a.findRecord("menuName",c,0,false,false,true)}if(!b||!b.data.leaf){b=a.findRecord("moduleCode",c,0,false,false,true)}if(!b){Hc.alert("模块编号或名称【"+c+"】不存在");return}this.onTreeMenuClick(null,b)},onTreeMenuClick:function(e,b){if(!b.data.leaf||!b.data.url){return}console.info(e);console.info(b);var f=this,g=b.data.url.split("#"),d=b.data.appCode.toLowerCase(),a=g[0]+b.data.jsUrl;console.info(b.data.jsUrl);console.info("jspath");console.info(g);console.info(g[0]);console.info(a);if(d=="integ"){Hc.basePath=g[0]}else{Hc[d+"Path"]=g[0]}var c=d+"IsLoaded";if(d!="integ"&&!Hc[c]){Ext.Loader.loadScript({url:a,onLoad:function(){f.createTab(b.data);Hc[c]=true},onError:function(){Hc.alert("加载应用的Js文件出错")}})}else{f.createTab(b.data)}},createTab:function(f){console.info("这是最棒的111");var g=Ext.getCmp("maintabpanel"),c="tab_"+f.menuNo,e=f.url.split("#")[1],b=g.getComponent(c),a=this.getUserInfo();console.info("这是最棒的");if(!this.checkModule(e)){return}if(!b){var d={title:f.menuName,itemId:c,xtype:e,userRight:f.rightValue,moduleRight:f.rights,userName:a.userName,userCode:a.userCode,closable:true,reorderable:true,loadMask:"加载中..."};b=g.add(d)}g.setActiveTab(b)},checkModule:function(b){console.info("这是最棒的"+b);var a=Ext.ClassManager.getNameByAlias("widget."+b);if(a){return true}Hc.alert("URL出错,无法创建此模块");return false},setLastVisitMenu:function(d){var f=this.lookupReference("lastvisittree"),b=f.getStore(),e=15,a=b.getRoot(),c=a.findChild("menuNo",d.menuNo);if(c){c.remove()}if(a.childCount>=e){a.lastChild.remove()}c=Ext.create("Hc_Framework.model.LastVisit",{id:d.menuNo,text:d.menuName,leaf:true,menuNo:d.menuNo,menuName:d.menuName,moduleNo:d.moduleNo,moduleName:d.moduleName,moduleUrl:d.moduleUrl});a.insertChild(0,c);b.sync()},onDoing:function(a){Hc.alert("填出信息");this.setMsg("功能【"+a.getText()+"】正在开发中...")},setUserPassword:function(){var c=this,b=c.getViewModel(),a=b.get("currentUser");if(!a){return}Ext.widget("window",{closeAction:"destroy",modal:true,bodyPadding:"20 40 20 20",title:"更改密码",autoShow:true,items:{xtype:"form",baseCls:"x-plain",defaults:{labelWidth:60,allowBlank:false},defaultType:"textfield",items:[{name:"oldPassword",inputType:"password",fieldLabel:"原密码"},{name:"password",inputType:"password",fieldLabel:"新密码"},{name:"newPwd2",inputType:"password",fieldLabel:"确认密码",vtype:"compareTo",compareTo:"password",compareError:"新密码跟确认密码输入不一致"},{name:"userId",xtype:"hiddenfield",bind:{value:"{currentUser.userId}"}}]},bbar:["->",{xtype:"button",text:"确认",handler:"onBtnSetPwdClick",scope:c,glyph:Hc.Icon.btnSave},{xtype:"button",text:"取消",handler:function(d){d.up("window").close()},glyph:Hc.Icon.btnCancel}]})},onBtnSetPwdClick:function(b){var d=this,e=b.up("window"),c=e.down("form"),g=c.getValues();if(c.isValid()){console.info("单击前");var a={userId:g.userId,password:hex_md5(g.password),oldPassword:hex_md5(g.oldPassword)},f=a;console.info("单击后");Ext.Ajax.request({url:Hc.basePath+"itg_login_user/changePassword.json",params:f,method:"POST",success:function(i){var h=JSON.parse(i.responseText);if(h.result){if(h.result.resultCode==0){Hc.alert("更改密码成功,请重新登录系统",function(){d.loginOut()})}else{Hc.alert(h.result.msg)}}else{Hc.alert("不明错误")}},failure:function(h){Hc.alert("系统异常!"+h.responseText)}})}},setMsg:function(a){this.getViewModel().set("msg.text",a)}});
Ext.define("Hc_Framework.view.ucmain.MainModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.main",data:{system:{name:"",version:"",copyright:"Copyright ©2014~2020 Hc All Rights Reserved"},msg:{text:"加载完毕",state:"s"},currentUser:null},formulas:{systemInfo:function(a){return a("name")+a("version")}}});
Ext.define("Hc_Framework.view.ucmain.menu.LastVisitTree",{extend:"Ext.tree.Panel",xtype:"lastvisittree",header:{hidden:true},reference:"lastvisittree",rootVisible:true,lines:true,hideHeaders:true,columns:[{dataIndex:"menuName",xtype:"treecolumn",flex:1}],store:{type:"lastvisit"},listeners:{itemclick:"onTreeMenuClick"},initComponent:function(){this.callParent()}});
Ext.define("Hc_Framework.view.ucmain.menu.MainTree",{extend:"Ext.tree.Panel",alias:"widget.maintree",header:{hidden:true},rootVisible:false,lines:true,hideHeaders:true,listeners:{itemdblclick:"onTreeMenuClick"},viewConfig:{enableTextSelection:true},initComponent:function(){var a=this;a.columns=[{xtype:"treecolumn",flex:1,dataIndex:"menuName",renderer:function(c){var b=a.searchField.getValue();if(b.length>0){return a.strMarkRedPlus(b,c)}return c}}];Ext.apply(a,{store:Ext.create("Hc_Framework.store.MainTree"),dockedItems:[{xtype:"textfield",dock:"top",emptyText:"查询",enableKeyEvents:true,triggers:{clear:{cls:"x-form-clear-trigger",handler:"onClearTriggerClick",hidden:true,scope:"this"},search:{cls:"x-form-search-trigger",weight:1,handler:"onSearchModule"}},onClearTriggerClick:function(){this.setValue();a.store.clearFilter();this.getTrigger("clear").hide()},listeners:{keyup:{fn:function(d,c){if(c.keyCode==Ext.event.Event.ENTER){a.up("app-main").controller.onSearchModule(d);return}var b=d.getValue();if(b){d.getTrigger("clear").show();a.filterStore(b)}else{a.store.clearFilter();d.getTrigger("clear").hide()}},buffer:300},render:function(b){this.searchField=b},scope:a}}]});a.callParent(arguments);a.store.on("load",function(c,b){if(b&&b.length>0){a.expandNode(b[0],true)}})},filterStore:function(e){var d=this,b=d.store,c=e.toLowerCase(),f=function(k){var j=k.childNodes,g=j&&j.length,l=a.test(k.get("menuName"))||a.test(k.get("moduleNo"))||a.test(k.get("moduleCode")),h;if(!l){for(h=0;h<g;h++){if(j[h].isLeaf()){l=j[h].get("visible")}else{l=f(j[h])}if(l){break}}}else{for(h=0;h<g;h++){j[h].set("visible",true)}}return l},a;if(c.length<1){b.clearFilter()}else{a=new RegExp(c,"i");b.getFilters().replaceAll({filterFn:f})}},strMarkRedPlus:function(b,a){return a.replace(new RegExp("("+b+")","gi"),"<span style='color: indianred;'><b>$1</b></span>")}});
Ext.define("Hc_Framework.view.ucmain.menu.MyFavorite",{extend:"Ext.tree.Panel",xtype:"myfavorite",header:{hidden:true},rootVisible:true,lines:true,hideHeaders:true,columns:[{dataIndex:"menuName",xtype:"treecolumn",flex:1}],store:{type:"myfavorite"},listeners:{itemclick:"onTreeMenuClick"},initComponent:function(){this.callParent()}});
Ext.define("Hc_Framework.view.ucmain.region.Center",{extend:"Ext.tab.Panel",alias:"widget.maincenter",uses:["Hc_Framework.view.uchome.HomePage","Hc_Framework.view.itgloginuser.ItgLoginUser"],closeAction:"hide",autoDestroy:true,tabPosition:"top",border:false,id:"maintabpanel",plugins:[{ptype:"tabclosemenu",closeAllTabsText:"关闭所有",closeOthersTabsText:"关闭其他",closeTabText:"关闭"},Ext.create("Ext.ux.TabReorderer")],initComponent:function(){this.items=[{glyph:Hc.Icon.btnHome,xtype:"homepage",reorderable:false}];this.callParent()}});
Ext.define("Hc_Framework.view.ucmain.region.LeftMenu",{extend:"Ext.Container",alias:"widget.leftmenu",layout:"fit",border:false,items:[{xtype:"maintree",reorderable:false,border:false}],initComponent:function(){this.callParent()}});
Ext.define("Hc_Framework.view.ucmain.region.Top",{extend:"Ext.Container",alias:"widget.maintop",id:"app-header",title:"怀臣生产管理系统",titleEn:"huaichen factory 1",layout:{type:"hbox",align:"middle"},initComponent:function(){document.title=this.title;this.items=[{xtype:"component",id:"app-header-logo"},{xtype:"component",html:'<span id="app-header-title-en"><span>'+this.titleEn+'<br /><span id="app-header-title">'+this.title+"</span>"},{xtype:"component",id:"app-header-systemname",bind:{html:"{system.name}"}},{xtype:"component",id:"app-header-version",bind:{html:"<span onclick=\"Hc.openUrl('releaselog.html','发布日志')\" style=\"cursor: pointer\">{system.version}</span>"},flex:1},{xtype:"toolbar",baseCls:"x-place",style:"color:red",id:"app-header-toolbar",items:[{bind:{text:"{currentUser.deptName}"},glyph:Hc.Icon.btnGroup},{bind:{text:"{currentUser.userName}"},glyph:Hc.Icon.btnUser},{text:"通讯录",handler:"onDoing",glyph:Hc.Icon.btnAddressList},{text:"设置",glyph:Hc.Icon.btnSetting,handler:"setUserPassword"},{text:"退出",glyph:Hc.Icon.btnExit,handler:"onExitButtonClick"}]}];this.callParent()}});
Ext.application({extend:"Hc_Framework.Application",appFolder:"resources/app",name:"Hc_Framework"});
